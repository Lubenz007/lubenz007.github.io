<!DOCTYPE html>
<html lang="{{ .Site.LanguageCode }}" dir="auto" data-theme="{{ .Site.Params.defaultTheme | default "auto" }}">
<head>
  {{ partial "head.html" . }}
</head>
<body>
  <!-- Sidebar -->
  {{ partial "sidebar.html" . }}
  
  <!-- Mobile overlay -->
  <div class="sidebar-overlay"></div>
  
  <!-- Main Content Wrapper -->
  <div class="main-wrapper">
    <!-- Top Bar -->
    <div id="topbar">
      <div class="container-fluid">
        <button type="button" id="sidebar-toggle" class="btn btn-link d-lg-none">
          <i class="fas fa-bars fa-fw"></i>
        </button>
        <div id="breadcrumb">
          {{ partial "breadcrumb.html" . }}
        </div>
        <!-- Top Menu and Theme toggle -->
        <div class="topbar-right">
          <nav class="top-nav d-none d-lg-block">
            <ul class="top-nav-list">
              <li class="top-nav-item">
                <a href="/search/" class="top-nav-link">
                  <i class="fas fa-search"></i>
                </a>
              </li>
              <li class="top-nav-item">
                <a href="/feed.xml" class="top-nav-link" title="RSS Feed">
                  <i class="fas fa-rss"></i>
                </a>
              </li>
            </ul>
          </nav>
          <button type="button" class="btn btn-link theme-toggle" id="theme-toggle">
            <i class="fas fa-adjust fa-fw"></i>
          </button>
        </div>
      </div>
    </div>
    
    <!-- Main Content with Right Sidebar -->
    <div class="content-wrapper">
      <main class="main">
        {{ block "main" . }}{{ end }}
      </main>
      
      <!-- Right Sidebar (only on larger screens) -->
      <div class="right-sidebar-wrapper d-none d-xl-block">
        {{ partial "right-sidebar.html" . }}
      </div>
    </div>
    
    <!-- Footer -->
    {{ partial "footer.html" . }}
  </div>

  <!-- Scripts -->
  <script>
    // Theme toggle functionality
    document.addEventListener('DOMContentLoaded', function() {
      const themeToggle = document.getElementById('theme-toggle');
      const sidebarToggle = document.getElementById('sidebar-toggle');
      const sidebar = document.getElementById('sidebar');
      const overlay = document.querySelector('.sidebar-overlay');
      
      // Theme toggle
      if (themeToggle) {
        themeToggle.addEventListener('click', function() {
          const currentTheme = document.documentElement.getAttribute('data-theme');
          const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
          document.documentElement.setAttribute('data-theme', newTheme);
          localStorage.setItem('theme', newTheme);
        });
      }
      
      // Mobile sidebar toggle
      if (sidebarToggle) {
        sidebarToggle.addEventListener('click', function() {
          sidebar.classList.toggle('active');
          overlay.classList.toggle('active');
          document.body.classList.toggle('sidebar-open');
        });
      }
      
      // Close sidebar when clicking overlay
      if (overlay) {
        overlay.addEventListener('click', function() {
          sidebar.classList.remove('active');
          overlay.classList.remove('active');
          document.body.classList.remove('sidebar-open');
        });
      }
      
      // Collapsible menu functionality
      const navToggles = document.querySelectorAll('.nav-toggle');
      navToggles.forEach(function(toggle) {
        toggle.addEventListener('click', function(e) {
          e.preventDefault();
          const parent = this.parentElement;
          const submenu = parent.querySelector('.nav-submenu');
          
          // Toggle open class
          parent.classList.toggle('open');
          
          // Close other open menus
          navToggles.forEach(function(otherToggle) {
            if (otherToggle !== toggle) {
              otherToggle.parentElement.classList.remove('open');
            }
          });
        });
      });
      
      // Load saved theme
      const savedTheme = localStorage.getItem('theme') || 'auto';
      if (savedTheme === 'auto') {
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        document.documentElement.setAttribute('data-theme', prefersDark ? 'dark' : 'light');
      } else {
        document.documentElement.setAttribute('data-theme', savedTheme);
      }
    });
  </script>
</body>
</html>