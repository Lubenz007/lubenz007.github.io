<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Azure | BensiEgils</title>
<meta name="keywords" content="">
<meta name="description" content="Documenting my journey">
<meta name="author" content="Benedikt Gabriel Egilsson">
<link rel="canonical" href="http://localhost:1313/tags/azure/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.c4ed1b680c91e8fe56dd269cacca84b1bbedcb34583cee1c5ddf7ad3cd9055ff.css" integrity="sha256-xO0baAyR6P5W3SacrMqEsbvtyzRYPO4cXd96082QVf8=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" type="application/rss+xml" href="http://localhost:1313/tags/azure/index.xml" title="rss">
<link rel="alternate" hreflang="en" href="http://localhost:1313/tags/azure/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:url" content="http://localhost:1313/tags/azure/">
  <meta property="og:site_name" content="BensiEgils">
  <meta property="og:title" content="Azure">
  <meta property="og:description" content="Documenting my journey">
  <meta property="og:locale" content="en-us">
  <meta property="og:type" content="website">
      <meta property="og:image" content="http://localhost:1313/">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://localhost:1313/">
<meta name="twitter:title" content="Azure">
<meta name="twitter:description" content="Documenting my journey">

</head>

<body class="list" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }
</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="BensiEgils (Alt + H)">
                <img src="http://localhost:1313/assets/img/logo/BensiLogo.png" alt="" aria-label="logo"
                    height="35">BensiEgils</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"></path>
                        <path d="m19 3-2 8-8 2 8 2 2 8 2-8 8-2-8-2-2-8Z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <path
                            d="M12 1v2M12 21v2M4.2 4.2l1.4 1.4M18.4 18.4l1.4 1.4M1 12h2M21 12h2M4.2 19.8l1.4-1.4M18.4 5.6l1.4-1.4">
                        </path>
                    </svg>
                </button>
                <ul class="lang-switch"><li>|</li>
                </ul>
            </div>
        </div>
        
        
        <button class="menu-toggle" id="menu-toggle" aria-label="Toggle navigation">
            <span></span>
            <span></span>
            <span></span>
        </button>
    </nav>
</header>


<aside class="sidebar" id="sidebar">
    <div class="sidebar-content">
        
        <div class="site-info">
        </div>

        
        <nav class="sidebar-nav">
            <ul class="nav-list">
                <li class="nav-item">
                    <a href="http://localhost:1313/" class="nav-link">
                        <i class="nav-icon">üè†</i>
                        <span>Home</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="http://localhost:1313/categories/" class="nav-link">
                        <i class="nav-icon"></i>
                        <span>Categories</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="http://localhost:1313/tags/" class="nav-link">
                        <i class="nav-icon"></i>
                        <span>Tags</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="http://localhost:1313/archives/" class="nav-link">
                        <i class="nav-icon"></i>
                        <span>Archives</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="http://localhost:1313/about/" class="nav-link">
                        <i class="nav-icon"></i>
                        <span>About</span>
                    </a>
                </li>
                
                <li class="nav-item">
                    <a href="/categories/" class="nav-link">
                        <i class="nav-icon">üìÅ</i>
                        <span>Categories</span>
                    </a>
                </li>
                
                <li class="nav-item">
                    <a href="/tags/" class="nav-link">
                        <i class="nav-icon">üè∑Ô∏è</i>
                        <span>Tags</span>
                    </a>
                </li>
                
                <li class="nav-item">
                    <a href="/archives/" class="nav-link">
                        <i class="nav-icon">üìö</i>
                        <span>Archives</span>
                    </a>
                </li>
                
                <li class="nav-item">
                    <a href="/about/" class="nav-link">
                        <i class="nav-icon">üë§</i>
                        <span>About</span>
                    </a>
                </li>
            </ul>
        </nav>

        
        <div class="categories-tree">
            <h4 class="tree-title">Categories</h4>
            <ul class="category-list">
                <li class="category-item">
                    <a href="/categories/automation" class="category-link">
                        <span class="category-name">Automation</span>
                        <span class="category-count">(4)</span>
                    </a>
                </li>
                <li class="category-item">
                    <a href="/categories/azure" class="category-link">
                        <span class="category-name">Azure</span>
                        <span class="category-count">(3)</span>
                    </a>
                </li>
                <li class="category-item">
                    <a href="/categories/hyper-v" class="category-link">
                        <span class="category-name">Hyper-V</span>
                        <span class="category-count">(1)</span>
                    </a>
                </li>
                <li class="category-item">
                    <a href="/categories/monitor" class="category-link">
                        <span class="category-name">Monitor</span>
                        <span class="category-count">(1)</span>
                    </a>
                </li>
                <li class="category-item">
                    <a href="/categories/msgraph" class="category-link">
                        <span class="category-name">Msgraph</span>
                        <span class="category-count">(6)</span>
                    </a>
                </li>
                <li class="category-item">
                    <a href="/categories/security" class="category-link">
                        <span class="category-name">Security</span>
                        <span class="category-count">(1)</span>
                    </a>
                </li>
                <li class="category-item">
                    <a href="/categories/terraform" class="category-link">
                        <span class="category-name">Terraform</span>
                        <span class="category-count">(1)</span>
                    </a>
                </li>
                <li class="category-item">
                    <a href="/categories/tools" class="category-link">
                        <span class="category-name">Tools</span>
                        <span class="category-count">(1)</span>
                    </a>
                </li>
                <li class="category-item">
                    <a href="/categories/usage" class="category-link">
                        <span class="category-name">Usage</span>
                        <span class="category-count">(3)</span>
                    </a>
                </li>
            </ul>
        </div>

        
        <div class="social-links">
            <h4 class="social-title">Connect</h4>
            <ul class="social-list">
                <li class="social-item">
                    <a href="https://twitter.com/lubenz007" target="_blank" rel="noopener noreferrer" class="social-link" title="twitter">
                        twitter
                    </a>
                </li>
                <li class="social-item">
                    <a href="https://github.com/lubenz007" target="_blank" rel="noopener noreferrer" class="social-link" title="github">
                        github
                    </a>
                </li>
                <li class="social-item">
                    <a href="https://www.linkedin.com/in/benedikt-gabr%c3%adel-egilsson-b7295684" target="_blank" rel="noopener noreferrer" class="social-link" title="linkedin">
                        linkedin
                    </a>
                </li>
            </ul>
        </div>
    </div>
</aside>


<div class="sidebar-overlay" id="sidebar-overlay"></div>

<style>
 
.sidebar {
    position: fixed;
    top: 0;
    left: 0;
    width: 260px;
    height: 100vh;
    background-color: var(--sidebar-bg);
    border-right: 1px solid var(--border-color);
    z-index: 1000;
    transform: translateX(0);
    transition: transform 0.3s ease;
    overflow-y: auto;
    padding-top: 80px;  
}

.sidebar-content {
    padding: 1.5rem 1rem;
}

.site-info {
    margin-bottom: 2rem;
    text-align: center;
}

.profile-img {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    margin-bottom: 1rem;
}

.profile-title {
    font-size: 1.2rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
    color: var(--text-color);
}

.profile-subtitle {
    font-size: 0.9rem;
    color: var(--text-muted);
    margin: 0;
}

.sidebar-nav {
    margin-bottom: 2rem;
}

.nav-list {
    list-style: none;
    padding: 0;
    margin: 0;
}

.nav-item {
    margin-bottom: 0.5rem;
}

.nav-link {
    display: flex;
    align-items: center;
    padding: 0.75rem 1rem;
    color: var(--text-color);
    text-decoration: none;
    border-radius: 0.375rem;
    transition: background-color 0.2s ease;
}

.nav-link:hover {
    background-color: var(--primary-color);
    color: white;
}

.nav-icon {
    margin-right: 0.75rem;
    font-size: 1.1rem;
}

.categories-tree {
    margin-bottom: 2rem;
}

.tree-title {
    font-size: 1rem;
    font-weight: 600;
    margin-bottom: 1rem;
    color: var(--text-color);
    padding: 0 1rem;
}

.category-list {
    list-style: none;
    padding: 0;
    margin: 0;
}

.category-item {
    margin-bottom: 0.25rem;
}

.category-link {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.5rem 1rem;
    color: var(--text-color);
    text-decoration: none;
    border-radius: 0.25rem;
    transition: background-color 0.2s ease;
}

.category-link:hover {
    background-color: var(--primary-color);
    color: white;
}

.category-count {
    font-size: 0.85rem;
    color: var(--text-muted);
}

.category-link:hover .category-count {
    color: rgba(255, 255, 255, 0.8);
}

.social-links {
    margin-top: auto;
}

.social-title {
    font-size: 1rem;
    font-weight: 600;
    margin-bottom: 1rem;
    color: var(--text-color);
    padding: 0 1rem;
}

.social-list {
    list-style: none;
    padding: 0;
    margin: 0;
}

.social-item {
    margin-bottom: 0.25rem;
}

.social-link {
    display: block;
    padding: 0.5rem 1rem;
    color: var(--text-color);
    text-decoration: none;
    border-radius: 0.25rem;
    transition: background-color 0.2s ease;
}

.social-link:hover {
    background-color: var(--primary-color);
    color: white;
}

 
@media (max-width: 768px) {
    .sidebar {
        transform: translateX(-100%);
    }
    
    .sidebar.open {
        transform: translateX(0);
    }
    
    .sidebar-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 999;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s ease, visibility 0.3s ease;
    }
    
    .sidebar-overlay.active {
        opacity: 1;
        visibility: visible;
    }
}

 
@media (min-width: 769px) {
    .main {
        margin-left: 260px;
    }
    
    .header {
        margin-left: 260px;
    }
}

 
.menu-toggle {
    display: none;
    flex-direction: column;
    background: none;
    border: none;
    cursor: pointer;
    padding: 0.5rem;
}

.menu-toggle span {
    width: 25px;
    height: 3px;
    background-color: var(--text-color);
    margin: 3px 0;
    transition: 0.3s;
}

@media (max-width: 768px) {
    .menu-toggle {
        display: flex;
    }
}
</style>

<script>

document.addEventListener('DOMContentLoaded', function() {
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('sidebar-overlay');
    const toggle = document.getElementById('menu-toggle');
    
    if (toggle && sidebar && overlay) {
        toggle.addEventListener('click', function() {
            sidebar.classList.toggle('open');
            overlay.classList.toggle('active');
        });
        
        overlay.addEventListener('click', function() {
            sidebar.classList.remove('open');
            overlay.classList.remove('active');
        });
    }
});
</script><main class="main"> 
<header class="page-header"><div class="breadcrumbs"><a href="http://localhost:1313/">Home</a>&nbsp;¬ª&nbsp;<a href="http://localhost:1313/tags/">Tags</a></div>
  <h1>
    Azure
    <a href="/tags/azure/index.xml" title="RSS" aria-label="RSS">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
        stroke-linecap="round" stroke-linejoin="round" height="23">
        <path d="M4 11a9 9 0 0 1 9 9" />
        <path d="M4 4a16 16 0 0 1 16 16" />
        <circle cx="5" cy="19" r="1" />
      </svg>
    </a>
  </h1>
</header>

<article class="post-entry tag-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">Apps Expiration Azure AD
    </h2>
  </header>
  <div class="entry-content">
    <p>This script will check all registered apps in Azure AD and will return the following information: expiring apps, expired apps, and apps with no expiration date. # needs permission Application.Read.All,Directory.Read.All $ClientID = &#39;&#39; $ClientSecret = &#39;&#39; $tenant_Id = &#39;&#39; $TenantName = $Body = @{ Grant_Type = &#34;client_credentials&#34; resource = &#34;https://graph.microsoft.com&#34; client_id = $clientId client_secret = $clientSecret } $ConnectGraph = Invoke-RestMethod -Uri &#34;https://login.microsoft.com/$tenant_Id/oauth2/token?api-version=1.0&#34; -Method POST -Body $Body # Variable Collections # $path = &#34;C:\temp\&#34; $today = Get-Date $Headers = @{ &#39;Content-Type&#39; = &#34;application/json&#34; &#39;Authorization&#39; = &#34;Bearer $($ConnectGraph.access_token)&#34; } $token = $ConnectGraph.access_token # Force TLS 1.2. [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12 function Get-GraphData { param ( [parameter(Mandatory)] [string]$AccessToken, [parameter(Mandatory)] [string]$Uri ) $Headers = @{ &#39;Authorization&#39; = &#34;Bearer $AccessToken&#34; } do { $Results = Invoke-RestMethod -Uri $Uri -Headers $Headers -ErrorAction Stop $QueryResults &#43;= $Results.value $Uri = $Results.&#39;@odata.nextLink&#39; } while ($Uri) return $QueryResults } #This request get application info $uri = &#34;https://graph.microsoft.com/beta/applications/&#34; [array]$apps = Get-GraphData -AccessToken $Token -Uri $uri $credentials = @() if ($apps) { foreach ($app in $apps) { $ApiUrl = &#34;https://graph.microsoft.com/beta/applications/&#34;&#43;$app.id&#43;&#34;/owners&#34; $owner = Invoke-WebRequest -Method GET -Uri $ApiUrl -ContentType &#34;application/json&#34; -Headers $headers | ConvertFrom-Json $app.KeyCredentials | foreach-object { #write-host $_.KeyId $_.DisplayName $credentials &#43;= [PSCustomObject] @{ CredentialType = &#34;KeyCredentials&#34;; DisplayName = $app.DisplayName; AppId = $app.AppId; ExpiryDate = $_.EndDateTime; StartDate = $_.StartDateTime; #KeyID = $_.KeyId; Type = $_.Type; Usage = $_.Usage; Owners = $owner.value.userPrincipalName; Expired = (([DateTime]$_.EndDateTime) -lt $today) ? &#34;Yes&#34; : &#34;No&#34;; } } $app.PasswordCredentials | foreach-object { #write-host $_.KeyId $_.DisplayName $credentials &#43;= [PSCustomObject] @{ CredentialType = &#34;PasswordCredentials&#34;; DisplayName = $app.DisplayName; AppId = $app.AppId; ExpiryDate = $_.EndDateTime; StartDate = $_.StartDateTime; #KeyID = $_.KeyId; Type = &#39;NA&#39;; Usage = &#39;NA&#39;; Owners = $owner.value.userPrincipalName; Expired = (([DateTime]$_.EndDateTime) -lt $today) ? &#34;Yes&#34; : &#34;No&#34;; } } } } $credentials | Export-Csv -Path $path\credentials.csv -NoTypeInformation #$credentials | Format-Table | Out-String|ForEach-Object {Write-Host $_} reference https://pnp.github.io/script-samples/aad-apps-expired-keys/README.html?tabs=graphps {: .prompt-info }
...</p>
  </div>
  <footer class="entry-footer"><span title='2023-04-07 10:34:00 +0000 GMT'>April 7, 2023</span>&nbsp;¬∑&nbsp;<span>2 min</span>&nbsp;¬∑&nbsp;<span>298 words</span>&nbsp;¬∑&nbsp;<span>Benedikt Gabriel Egilsson</span></footer>
  <a class="entry-link" aria-label="post link to Apps Expiration Azure AD" href="http://localhost:1313/posts/2023-04-07-apps-exp/"></a>
</article>

<article class="post-entry tag-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">Getting licenses assigned to user accounts
    </h2>
  </header>
  <div class="entry-content">
    <p>Create a report of licenses assigned to Azure AD user accounts using the Microsoft Graph API This is a rewrite from here practical365.com My misson was to rewrite the script to use the Microsoft Graph API instead of the MgGraph PowerShell module. {: .prompt-info }
$ClientID = &#39;&#39; $ClientSecret = &#39;&#39; $tenant_Id = &#39;&#39; # Connect to Graph # $Body = @{ Grant_Type = &#34;client_credentials&#34; resource = &#34;https://graph.microsoft.com&#34; client_id = $clientId client_secret = $clientSecret } $ConnectGraph = Invoke-RestMethod -Uri &#34;https://login.microsoft.com/$tenant_Id/oauth2/token?api-version=1.0&#34; -Method POST -Body $Body # Variable Collections # $CSVOutputFile = &#34;c:\temp\Microsoft365LicensesReport.CSV&#34; $today = Get-Date $Headers = @{ &#39;Content-Type&#39; = &#34;application/json&#34; &#39;Authorization&#39; = &#34;Bearer $($ConnectGraph.access_token)&#34; } $token = $ConnectGraph.access_token # Force TLS 1.2. [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12 function Get-GraphData { param ( [parameter(Mandatory)] [string]$AccessToken, [parameter(Mandatory)] [string]$Uri ) $Headers = @{ &#39;Authorization&#39; = &#34;Bearer $AccessToken&#34; } do { $Results = Invoke-RestMethod -Uri $Uri -Headers $Headers -ErrorAction Stop $QueryResults &#43;= $Results.value $Uri = $Results.&#39;@odata.nextLink&#39; } while ($Uri) return $QueryResults } #This request get SecureScore [array]$Skus = Get-GraphData -AccessToken $Token -Uri &#34;https://graph.microsoft.com/beta/subscribedSkus&#34; #[Array]$Skus = Get-MgSubscribedSku # Generate CSV of all product SKUs used in tenant [array]$Sku = $Skus | Select-Object SkuId, SkuPartNumber # Generate list of all service plans used in SKUs in tenant $SPData = [System.Collections.Generic.List[Object]]::new() ForEach ($Sk in $Skus) { ForEach ($SP in $Sk.ServicePlans) { $SPLine = [PSCustomObject][Ordered]@{ ServicePlanId = $SP.ServicePlanId ServicePlanName = $SP.ServicePlanName ServicePlanDisplayName = $SP.ServicePlanName } $SPData.Add($SPLine) } } $SkuHashTable = @{} ForEach ($Line in $Sku) { $SkuHashTable.Add([string]$Line.SkuId, [string]$Line.skuPartNumber) } $ServicePlanHashTable = @{} ForEach ($Line2 in $SPData) { $ServicePlanHashTable.Add([string]$Line2.ServicePlanId, [string]$Line2.ServicePlanDisplayName) } [Array]$Users = Get-GraphData -AccessToken $Token -Uri &#34;https://graph.microsoft.com/beta/users&#34; $Report = [System.Collections.Generic.List[Object]]::new() ForEach ($User in $users) { If ([string]::IsNullOrWhiteSpace($User.AssignedLicenses) -eq $true) { # Only process account if it has some licenses Write-Host &#34;Processing&#34; $User.DisplayName [array]$LicenseInfo = $Null; [array]$DisabledPlans = $Null ForEach ($License in $User.AssignedLicenses) { If ($SkuHashTable.ContainsKey($License.SkuId) -eq $True) { # We found a match in the SKU hash table $LicenseInfo &#43;= $SkuHashTable.Item($License.SkuId) } Else { # Nothing doing, so output the SkuID $LicenseInfo &#43;= $License } # Report any disabled service plans in licenses If ([string]::IsNullOrWhiteSpace($License.DisabledPlans) -eq $False ) { # Check if disabled service plans in a license ForEach ($DisabledPlan in $License.DisabledPlans) { # Try and find what service plan is disabled If ($ServicePlanHashTable.ContainsKey($DisabledPlan) -eq $True) { # We found a match in the Service Plans hash table $DisabledPlans &#43;= $ServicePlanHashTable.Item($DisabledPlan) } Else { # Nothing doing, so output the Service Plan ID $DisabledPlans &#43;= $DisabledPlan } } # End ForEach disabled plans } # End if check for disabled plans } # End Foreach Licenses # Report information [string]$DisabledPlans = $DisabledPlans -join &#34;, &#34; [string]$LicenseInfo = $LicenseInfo -join (&#34;, &#34;) $ReportLine = [PSCustomObject][Ordered]@{ User = $User.DisplayName UPN = $User.UserPrincipalName Country = $User.Country Department = $User.Department Title = $User.JobTitle Licenses = $LicenseInfo &#34;Disabled Plans&#34; = $DisabledPlans } Write-Host $ReportLine $Report.Add($ReportLine) } #end If account is licensed Else { $UnlicensedAccounts&#43;&#43; } } # End ForEach Users $Report | Export-CSV -NoTypeInformation $CSVOutputFile </p>
  </div>
  <footer class="entry-footer"><span title='2023-04-01 00:27:00 +0000 GMT'>April 1, 2023</span>&nbsp;¬∑&nbsp;<span>3 min</span>&nbsp;¬∑&nbsp;<span>480 words</span>&nbsp;¬∑&nbsp;<span>Benedikt Gabriel Egilsson</span></footer>
  <a class="entry-link" aria-label="post link to Getting licenses assigned to user accounts" href="http://localhost:1313/posts/2023-01-04-license-report/"></a>
</article>

<article class="post-entry tag-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">MS Graph API - Get Secure Score for tenant
    </h2>
  </header>
  <div class="entry-content">
    <p>Secure Score for O365 Tenant Getting the secure score for a tenant is a bit more complicated than getting the last logon time of a user. You only need to call the following endpoint: https://graph.microsoft.com/beta/security/secureScores and divide the result by 100 to get the percentage.
# Needs permission SecurityEvents.Read.All $ClientID = &#39;&#39; $ClientSecret = &#39;&#39; $tenant_Id = &#39;&#39; # Connect to Graph # $Body = @{ Grant_Type = &#34;client_credentials&#34; resource = &#34;https://graph.microsoft.com&#34; client_id = $clientId client_secret = $clientSecret } $ConnectGraph = Invoke-RestMethod -Uri &#34;https://login.microsoft.com/$tenant_Id/oauth2/token?api-version=1.0&#34; -Method POST -Body $Body # Variable Collections # $path = &#34;C:\temp\&#34; $Headers = @{ &#39;Content-Type&#39; = &#34;application/json&#34; &#39;Authorization&#39; = &#34;Bearer $($ConnectGraph.access_token)&#34; } $token = $ConnectGraph.access_token # Force TLS 1.2. [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12 function Get-GraphData { param ( [parameter(Mandatory)] [string]$AccessToken, [parameter(Mandatory)] [string]$Uri ) $Headers = @{ &#39;Authorization&#39; = &#34;Bearer $AccessToken&#34; } do { $Results = Invoke-RestMethod -Uri $Uri -Headers $Headers -ErrorAction Stop $QueryResults &#43;= $Results.value $Uri = $Results.&#39;@odata.nextLink&#39; } while ($Uri) return $QueryResults } #This request get SecureScore $uri = &#34;https://graph.microsoft.com/beta/security/secureScores&#34; $Result = @() [array]$Response = Get-GraphData -AccessToken $Token -Uri $uri if ($Response) { ForEach ($Respons in $Response) { $SecureScore = $Respons.currentScore / $Respons.maxScore * 100 $Result &#43;= New-Object PSObject -property $([ordered]@{ CreatedDateTime = $Respons.createdDateTime CurrentScore = $Respons.currentScore MaxScore = $Respons.maxScore LicensedUserCount = $Respons.licensedUserCount ActiveUserCount = $Respons.activeUserCount SecureScore = [math]::Round($SecureScore, 2) }) } } else { Write-Host &#34;No SecureScore data found&#34; } # export to csv $Result | export-csv -path &#34;$path\SecureScore.csv&#34; -NoTypeInformation </p>
  </div>
  <footer class="entry-footer"><span title='2023-03-25 22:49:00 +0000 GMT'>March 25, 2023</span>&nbsp;¬∑&nbsp;<span>2 min</span>&nbsp;¬∑&nbsp;<span>235 words</span>&nbsp;¬∑&nbsp;<span>Benedikt Gabriel Egilsson</span></footer>
  <a class="entry-link" aria-label="post link to MS Graph API - Get Secure Score for tenant" href="http://localhost:1313/posts/2023-03-23-sgraph-securescore/"></a>
</article>

<article class="post-entry tag-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">Getting Started with MSGraph API
    </h2>
  </header>
  <div class="entry-content">
    <p>Authentication and Authorization MSGraph API is a powerful tool for authentication and authorization that allows developers to access Microsoft services and data. It provides a secure way to authenticate users, authorize applications, and manage user data. With MSGraph API, developers can easily integrate their applications with Microsoft services like Outlook, OneDrive, Office 365, Azure Active Directory, and more. In this article, we‚Äôll explore how to get started with MSGraph API concepts and use cases of the API. Authentication We will use the Azure CLI to create a service principal and get the app id and secret. We will also use the Azure CLI to view all the API permissions available in Microsoft Graph. Get the Azure CLI from here {: .prompt-info }
...</p>
  </div>
  <footer class="entry-footer"><span title='2023-03-25 13:49:00 +0000 GMT'>March 25, 2023</span>&nbsp;¬∑&nbsp;<span>2 min</span>&nbsp;¬∑&nbsp;<span>352 words</span>&nbsp;¬∑&nbsp;<span>Benedikt Gabriel Egilsson</span></footer>
  <a class="entry-link" aria-label="post link to Getting Started with MSGraph API" href="http://localhost:1313/posts/2023-03-23-sgraph-api/"></a>
</article>

<article class="post-entry tag-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">MS Graph API - Get User info
    </h2>
  </header>
  <div class="entry-content">
    <p>Microsoft Graph API can be used to get the last logon time of a user. To do this, you will need to make a GET request to the /users/{id}/lastLogonTimeStamp endpoint. This endpoint will return the last logon time of the user in the form of a timestamp. You can then use this timestamp to determine the exact date and time of the user‚Äôs last logon. This query get‚Äôs.
DisplayName,UserPrincipalName,UsageLocation,Contry,LastSignInDateTime,IsLicensed,IsGuestUser {: .prompt-info }
...</p>
  </div>
  <footer class="entry-footer"><span title='2023-03-25 13:49:00 +0000 GMT'>March 25, 2023</span>&nbsp;¬∑&nbsp;<span>2 min</span>&nbsp;¬∑&nbsp;<span>316 words</span>&nbsp;¬∑&nbsp;<span>Benedikt Gabriel Egilsson</span></footer>
  <a class="entry-link" aria-label="post link to MS Graph API - Get User info" href="http://localhost:1313/posts/2023-03-23-sgraph-users/"></a>
</article>
<footer class="page-footer">
  <nav class="pagination">
    <a class="prev" href="http://localhost:1313/tags/azure/">
      ¬´&nbsp;Prev&nbsp;
    </a>
  </nav>
</footer>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="http://localhost:1313/">BensiEgils</a></span> ¬∑ 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
