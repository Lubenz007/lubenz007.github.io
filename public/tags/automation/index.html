<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Automation | BensiEgils</title>
<meta name="keywords" content="">
<meta name="description" content="Documenting my journey">
<meta name="author" content="Benedikt Gabriel Egilsson">
<link rel="canonical" href="http://localhost:1313/tags/automation/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.2d0325420c619a782224fbdbc50e6417d66f71c30e5607ad7ddb5b0ecce5d6cc.css" integrity="sha256-LQMlQgxhmngiJPvbxQ5kF9ZvccMOVgetfdtbDszl1sw=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" type="application/rss+xml" href="http://localhost:1313/tags/automation/index.xml" title="rss">
<link rel="alternate" hreflang="en" href="http://localhost:1313/tags/automation/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:url" content="http://localhost:1313/tags/automation/">
  <meta property="og:site_name" content="BensiEgils">
  <meta property="og:title" content="Automation">
  <meta property="og:description" content="Documenting my journey">
  <meta property="og:locale" content="en-us">
  <meta property="og:type" content="website">
      <meta property="og:image" content="http://localhost:1313/">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://localhost:1313/">
<meta name="twitter:title" content="Automation">
<meta name="twitter:description" content="Documenting my journey">

</head>

<body class="list" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="BensiEgils (Alt + H)">BensiEgils</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/categories/" title="Categories">
                    <span>Categories</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/archives/" title="Archives">
                    <span>Archives</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main"> 
<header class="page-header"><div class="breadcrumbs"><a href="http://localhost:1313/">Home</a>&nbsp;»&nbsp;<a href="http://localhost:1313/tags/">Tags</a></div>
  <h1>
    Automation
    <a href="/tags/automation/index.xml" title="RSS" aria-label="RSS">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
        stroke-linecap="round" stroke-linejoin="round" height="23">
        <path d="M4 11a9 9 0 0 1 9 9" />
        <path d="M4 4a16 16 0 0 1 16 16" />
        <circle cx="5" cy="19" r="1" />
      </svg>
    </a>
  </h1>
</header>

<article class="post-entry tag-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">GSPRO Control box
    </h2>
  </header>
  <div class="entry-content">
    <p>esp32 code to create GSPRO Control box {: width=“350” height=“200” } {: width=“350” height=“200” }
// Benedikt Gabriel Egilsson - bensiegils.com // 1= 5 - Camera to ball // 2= KEY_M_CTRL - Muligan // 3= T - Scorecard display // 4= P - See the pin // 5= O - Flyover of the hole // 6= . - shadow quality // 7= B - Hide - Make objects in your line of sight invisible // 8= Z - Hide or show the 3D gras // 9= KEY_UP_ARROW // 10= KEY_DOWN_ARROW // 11= KEY_LEFT_ARROW // 12= KEY_RIGHT_ARROW #define USE_NIMBLE #include &lt;BleKeyboard.h&gt; BleKeyboard bleKeyboard(&#34;GSPRO BOX&#34;); #define NUM_KEYS 12 struct Key { int pin; uint8_t code; bool state; bool isCtrl; // New field to indicate if Ctrl needs to be held }; Key keys[NUM_KEYS] = { {16, &#39;5&#39;, false, false}, {17, &#39;m&#39;, false, true}, // &#39;m&#39; with Ctrl modifier {18, &#39;t&#39;, false, false}, {19, &#39;p&#39;, false, false}, {21, &#39;o&#39;, false, false}, {22, &#39;.&#39;, false, false}, {32, &#39;b&#39;, false, false}, {33, &#39;z&#39;, false, false}, {27, KEY_UP_ARROW, false, false}, {14, KEY_DOWN_ARROW, false, false}, {12, KEY_LEFT_ARROW, false, false}, {13, KEY_RIGHT_ARROW, false, false} }; bool connectNotificationSent = false; void setup() { Serial.begin(115200); Serial.println(&#34;Code running...&#34;); // Set pin modes for (int i = 0; i &lt; NUM_KEYS; i&#43;&#43;) { pinMode(keys[i].pin, INPUT_PULLUP); } // Initialize BLE keyboard bleKeyboard.begin(); } void loop() { if (bleKeyboard.isConnected()) { if (!connectNotificationSent) { Serial.println(&#34;BLE connected...&#34;); connectNotificationSent = true; } for (int i = 0; i &lt; NUM_KEYS; i&#43;&#43;) { handleButton(i); } } else { if (connectNotificationSent) { Serial.println(&#34;BLE disconnected...&#34;); connectNotificationSent = false; } } delay(10); // Small delay to stabilize readings } void handleButton(int keyIndex) { bool currentState = !digitalRead(keys[keyIndex].pin); // Read the button state (active low) if (currentState != keys[keyIndex].state) { keys[keyIndex].state = currentState; if (currentState) { if (keys[keyIndex].isCtrl) { // Check if Ctrl modifier is needed bleKeyboard.press(KEY_LEFT_CTRL); } bleKeyboard.press(keys[keyIndex].code); Serial.print(&#34;Key pressed: &#34;); } else { bleKeyboard.release(keys[keyIndex].code); if (keys[keyIndex].isCtrl) { // Check if Ctrl modifier is needed bleKeyboard.release(KEY_LEFT_CTRL); } Serial.print(&#34;Key released: &#34;); } Serial.println(keys[keyIndex].code); } } </p>
  </div>
  <footer class="entry-footer"><span title='2024-06-23 00:27:00 +0000 GMT'>June 23, 2024</span>&nbsp;·&nbsp;<span>2 min</span>&nbsp;·&nbsp;<span>333 words</span>&nbsp;·&nbsp;<span>Benedikt Gabriel Egilsson</span></footer>
  <a class="entry-link" aria-label="post link to GSPRO Control box" href="http://localhost:1313/posts/2024-06-23-gspro-controlbox/"></a>
</article>

<article class="post-entry tag-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">Powershell Speedtest
    </h2>
  </header>
  <div class="entry-content">
    <p>Was having problems with my internet connection and wanted to monitor it. So I rewrote this script to use powershell and store the results in a table storage. The script is using the speedtest cli from https://www.speedtest.net/apps/cli {: .prompt-info }
#$StorageAccountName = &#34;StorageAcount&#34; #$Key = &#34;Storagekey&#34; #$StorageContext = New-AzStorageContext -StorageAccountName $StorageAccountName -StorageAccountKey $Key #$Table = (Get-AzStorageTable -Context $StorageContext | Where-Object {$_.name -eq &#34;Speedtest&#34;}).CloudTable $applocation = &#34;C:\apps\speedtest&#34; $path = &#34;C:\temp\&#34; $SpeedTestResults=@() $SpeedtestObj=@() $i = 0 while ($i -eq 0) { $PartitionKey = &#34;1&#34; $SpeedTestResults = &amp; &#34;$($applocation)\speedtest.exe&#34; --progress=no --format=json $SpeedtestResults = $SpeedTestResults | ConvertFrom-Json $SpeedtestObj &#43;= [PSCustomObject] @{ Time = Get-Date -Format &#34;dd/MM/yyyy HH:mm K&#34; downloadspeed = [math]::Round($SpeedtestResults.download.bandwidth / 1000000 * 8, 2) uploadspeed = [math]::Round($SpeedtestResults.upload.bandwidth / 1000000 * 8, 2) packetloss = ($($SpeedtestResults.packetLoss).ToString(&#34;P&#34;)) isp = $SpeedtestResults.isp ExternalIP = $SpeedtestResults.interface.externalIp InternalIP = $SpeedtestResults.interface.internalIp UsedServer = $SpeedtestResults.server.host location = $SpeedTestResults.server.location Jitter = [math]::Round($SpeedtestResults.ping.jitter) Latency = [math]::Round($SpeedtestResults.ping.latency) } # ---- Move to table storage ---- # Add-AzTableRow -table $Table -PartitionKey $PartitionKey -RowKey (Get-Date).Ticks -property $SpeedtestObj Start-Sleep -Seconds 15 } #$SpeedtestObj | Format-Table | Out-String|ForEach-Object {Write-Host $_} $SpeedtestObj | Export-Csv -Path $path\speedtest.csv -NoTypeInformation </p>
  </div>
  <footer class="entry-footer"><span title='2023-04-06 20:15:00 +0000 GMT'>April 6, 2023</span>&nbsp;·&nbsp;<span>1 min</span>&nbsp;·&nbsp;<span>179 words</span>&nbsp;·&nbsp;<span>Benedikt Gabriel Egilsson</span></footer>
  <a class="entry-link" aria-label="post link to Powershell Speedtest" href="http://localhost:1313/posts/2023-04-06-speedtest/"></a>
</article>

<article class="post-entry tag-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">Esp32 Hot tub controller
    </h2>
  </header>
  <div class="entry-content">
    <p>This is my hot tub controler with outdoor shower controler. It is based on a ESP32 and a 4 channel relay module. It has a DS18B20 temperature sensor for the hot tub and a DS18B20 for the water in the hot tub. It also has a DS18B20 for the outdoor shower and a DS18B20 for the water in system. esphome: name: pottastyring platform: ESP32 board: nodemcu-32s wifi: ssid: &#34;&#34; password: &#34;&#34; domain: .lan manual_ip: static_ip: 192.168.x.x gateway: 192.168.x.x subnet: 255.255.255.0 dns1: 192.168.x.x # Enable fallback hotspot (captive portal) in case wifi connection fails ap: ssid: &#34;hottub&#34; password: &#34;&#34; captive_portal: web_server: port: 80 # Enable logging logger: # Enable Home Assistant API api: ota: time: - platform: sntp id: timer servers: - 0.pool.ntp.org - 1.pool.ntp.org - 2.pool.ntp.org dallas: - pin: GPIO13 sensor: - platform: dallas address: 0x67011464EA7EFF28 name: &#34;Pottur hiti&#34; id: pottur_hiti - platform: dallas address: 0x8B0314649975FF28 name: &#34;Vatn i pott&#34; id: vatn_i_hiti - platform: dallas address: 0x110000045976f328 name: &#34;Hiti Skapur&#34; id: Hiti_skapur - platform: dallas address: 0xe10314645814ff28 name: &#34;Hiti Uti&#34; id: hiti_uti binary_sensor: - platform: gpio filters: - delayed_on: 100ms id: fylla pin: number: GPIO17 mode: INPUT_PULLUP inverted: True name: &#34;Pottur fylla takki&#34; on_press: if: condition: lambda: &#39;return id(pottur_hiti).state &lt; 20;&#39; then: - logger.log: &#34;The sensor value is below 20!&#34; - switch.turn_on: relay_1 - delay: 1min - switch.turn_on: relay_4 - delay: 30min - switch.turn_off: relay_1 - delay: 3min - climate.control: id: pottur_climate mode: &#34;HEAT&#34; else: - logger.log: &#34;The sensor value is above 20!&#34; - platform: gpio filters: - delayed_on: 500ms id: sturta pin: number: GPIO21 mode: INPUT_PULLUP inverted: True name: &#34;Sturta takki&#34; on_press: if: condition: lambda: &#39;return id(pottur_hiti).state &gt; 38;&#39; then: - logger.log: &#34;The sensor value is above 38!&#34; - climate.control: id: pottur_climate mode: &#34;OFF&#34; - delay: 10sec - switch.turn_on: relay_3 - delay: 4min - switch.turn_off: relay_3 else: - logger.log: &#34;The sensor value is below 20!&#34; - switch.turn_on: relay_3 - delay: 4min - switch.turn_off: relay_3 - platform: gpio filters: - delayed_on: 500ms id: nidurfall pin: number: GPIO33 mode: INPUT_PULLUP inverted: True name: &#34;taema takki&#34; on_press: then: - switch.turn_off: relay_4 - climate.control: id: pottur_climate mode: &#34;off&#34; switch: - platform: gpio restore_mode: ALWAYS_OFF name: &#34;Pottur fylla relay&#34; pin: GPIO25 id: relay_1 - platform: gpio restore_mode: ALWAYS_OFF name: &#34;Pottur hita relay&#34; pin: GPIO26 id: relay_2 - platform: gpio restore_mode: ALWAYS_OFF name: &#34;Sturta relay&#34; pin: GPIO27 id: relay_3 - platform: gpio restore_mode: ALWAYS_ON name: &#34;Loka nidurfalli&#34; pin: GPIO18 id: relay_4 climate: - platform: bang_bang id: pottur_climate visual: min_temperature: 38 max_temperature: 42 temperature_step: 1.0 name: &#34;Pottur vatn&#34; sensor: pottur_hiti default_target_temperature_low: 38 °C default_target_temperature_high: 40 °C heat_action: if: condition: lambda: &#39;return id(pottur_hiti).state &gt; 32;&#39; then: - logger.log: &#34;The sensor is above 32! then full&#34; - switch.turn_on: relay_1 - switch.turn_on: relay_2 else: - logger.log: &#34;The sensor value is below 32!&#34; - switch.turn_on: relay_1 - delay: 1min - switch.turn_on: relay_4 - delay: 30min - switch.turn_on: relay_2 idle_action: - switch.turn_off: relay_2 - switch.turn_off: relay_1 mqtt: broker: 192.168.x.x username: xxx password: xxx </p>
  </div>
  <footer class="entry-footer"><span title='2023-04-04 22:15:00 +0000 GMT'>April 4, 2023</span>&nbsp;·&nbsp;<span>3 min</span>&nbsp;·&nbsp;<span>482 words</span>&nbsp;·&nbsp;<span>Benedikt Gabriel Egilsson</span></footer>
  <a class="entry-link" aria-label="post link to Esp32 Hot tub controller" href="http://localhost:1313/posts/2023-04-04-hottub/"></a>
</article>

<article class="post-entry tag-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">Upgrade Hyper-V Hosts with Azure Arc
    </h2>
  </header>
  <div class="entry-content">
    <p>Azure Arc is a powerful tool for managing and updating hybrid infrastructure, including standalone Hyper-V hosts. Demo how to use Azure Arc to update a standalone Hyper-V host, using a scheduled update task in Automation Account and pre and post scripts that shut down and start up VMs. Pre-requisites
# Stop all running VMs on the Hyper-V host and wait for them to shut down # save the names of the running VMs to a file $filePath = &#34;C:\temp\runningvm.txt&#34; (Get-vm | Where-Object { $_.State -eq &#34;Running&#34; }).name | Out-File $filePath $runningvm = Get-Content $filePath foreach ($Name in $runningvm) { Stop-VM $Name do { $VM1 = get-vm -Name $Name Write-Progress -Activity &#34;Waiting for the VM to shutdown&#34; } until ($Null -eq $VM1.Heartbeat) } # send a webhook to Teams to notify that the VMs have been shut down $webhookUri = &#34;&#34; $body = @{ &#34;@context&#34; = &#34;http://schema.org/extensions&#34; &#34;@type&#34; = &#34;MessageCard&#34; &#34;themeColor&#34; = &#34;d70000&#34; &#34;title&#34; = &#34;Send Webhook to Teams&#34; &#34;text&#34; = &#34;This is a message sent from Powershell&#34; } Invoke-RestMethod -Uri $webhookUri -Method Post -Body (ConvertTo-Json -InputObject $body) Post-requisites
...</p>
  </div>
  <footer class="entry-footer"><span title='2023-04-04 22:15:00 +0000 GMT'>April 4, 2023</span>&nbsp;·&nbsp;<span>2 min</span>&nbsp;·&nbsp;<span>354 words</span>&nbsp;·&nbsp;<span>Benedikt Gabriel Egilsson</span></footer>
  <a class="entry-link" aria-label="post link to Upgrade Hyper-V Hosts with Azure Arc" href="http://localhost:1313/posts/2023-04-04-upgrade-hyper/"></a>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="http://localhost:1313/">BensiEgils</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
