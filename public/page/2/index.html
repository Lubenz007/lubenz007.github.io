<!DOCTYPE html>
<html lang="en-us" dir="auto" data-theme="auto">
<head>
	<meta name="generator" content="Hugo 0.147.9"><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Documenting my journey with Azure, PowerShell, and automation">
<meta name="keywords" content="blog,azure,powershell,automation,security,hextra">
<meta name="author" content="">


<meta property="og:type" content="website">
<meta property="og:url" content="http://localhost:1313/">
<meta property="og:title" content="BensiEgils">
<meta property="og:description" content="Documenting my journey with Azure, PowerShell, and automation">
<meta property="og:image" content="http://localhost:1313/assets/img/logo/BensiLogo.png">


<meta property="twitter:card" content="summary_large_image">
<meta property="twitter:url" content="http://localhost:1313/">
<meta property="twitter:title" content="BensiEgils">
<meta property="twitter:description" content="Documenting my journey with Azure, PowerShell, and automation">
<meta property="twitter:image" content="http://localhost:1313/assets/img/logo/BensiLogo.png">





<script type="application/ld+json">
{
  "@context": "https://schema.org",
  
  "@type": "WebSite",
  "name": "BensiEgils",
  "url": "http:\/\/localhost:1313\/",
  "description": "Documenting my journey with Azure, PowerShell, and automation",
  "author": {
    "@type": "Person",
    "name": ""
  }
  
}
</script>


<link rel="canonical" href="http://localhost:1313/">


<link rel="alternate" type="application/rss+xml" title="BensiEgils" href="http://localhost:1313/index.xml">

<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">
<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">


<title>BensiEgils</title>
</head>
<body>
  
  
<aside class="sidebar" id="sidebar">
    <div class="sidebar-content">
        
        <div class="site-info">
            <div class="profile">
                <img src="/assets/img/logo/BensiLogo.png" alt="Profile" class="profile-img">
                <h3 class="profile-title">BensiEgils</h3>
                <p class="profile-subtitle">Documenting my journey with Azure, PowerShell, and automation</p>
            </div>
        </div>

        
        <nav class="sidebar-nav">
            <ul class="nav-list">
                <li class="nav-item">
                    <a href="http://localhost:1313/" class="nav-link active">
                        <i class="nav-icon fas fa-home"></i>
                        <span>Home</span>
                    </a>
                </li>
                
                
                <li class="nav-item has-submenu">
                    <a href="#" class="nav-link nav-toggle" data-toggle="categories">
                        <i class="nav-icon fas fa-folder"></i>
                        <span>Categories</span>
                        <i class="nav-arrow fas fa-chevron-down"></i>
                    </a>
                    <ul class="nav-submenu" id="categories-submenu">
                        <li class="nav-subitem">
                            <a href="/categories/automation" class="nav-sublink">
                                <span>Automation</span>
                                <span class="count">(4)</span>
                            </a>
                        </li>
                        <li class="nav-subitem">
                            <a href="/categories/azure" class="nav-sublink">
                                <span>Azure</span>
                                <span class="count">(3)</span>
                            </a>
                        </li>
                        <li class="nav-subitem">
                            <a href="/categories/hyper-v" class="nav-sublink">
                                <span>Hyper-V</span>
                                <span class="count">(1)</span>
                            </a>
                        </li>
                        <li class="nav-subitem">
                            <a href="/categories/monitor" class="nav-sublink">
                                <span>Monitor</span>
                                <span class="count">(1)</span>
                            </a>
                        </li>
                        <li class="nav-subitem">
                            <a href="/categories/msgraph" class="nav-sublink">
                                <span>Msgraph</span>
                                <span class="count">(6)</span>
                            </a>
                        </li>
                        <li class="nav-subitem">
                            <a href="/categories/security" class="nav-sublink">
                                <span>Security</span>
                                <span class="count">(1)</span>
                            </a>
                        </li>
                        <li class="nav-subitem">
                            <a href="/categories/terraform" class="nav-sublink">
                                <span>Terraform</span>
                                <span class="count">(1)</span>
                            </a>
                        </li>
                        <li class="nav-subitem">
                            <a href="/categories/tools" class="nav-sublink">
                                <span>Tools</span>
                                <span class="count">(1)</span>
                            </a>
                        </li>
                        <li class="nav-subitem">
                            <a href="/categories/usage" class="nav-sublink">
                                <span>Usage</span>
                                <span class="count">(3)</span>
                            </a>
                        </li>
                    </ul>
                </li>
                
                <li class="nav-item">
                    <a href="/tags/" class="nav-link">
                        <i class="nav-icon fas fa-tags"></i>
                        <span>Tags</span>
                    </a>
                </li>
                
                <li class="nav-item">
                    <a href="/archives/" class="nav-link">
                        <i class="nav-icon fas fa-archive"></i>
                        <span>Archives</span>
                    </a>
                </li>
                
                <li class="nav-item">
                    <a href="/about/" class="nav-link">
                        <i class="nav-icon fas fa-user"></i>
                        <span>About</span>
                    </a>
                </li>
                
                <li class="nav-item">
                    <a href="/archives/" class="nav-link">
                        <i class="nav-icon">ðŸ“š</i>
                        <span>Archives</span>
                    </a>
                </li>
                
                <li class="nav-item">
                    <a href="/about/" class="nav-link">
                        <i class="nav-icon">ðŸ‘¤</i>
                        <span>About</span>
                    </a>
                </li>
            </ul>
        </nav>

        
        <div class="categories-tree">
            <h4 class="tree-title">Categories</h4>
            <ul class="category-list">
                <li class="category-item">
                    <a href="/categories/automation" class="category-link">
                        <span class="category-name">Automation</span>
                        <span class="category-count">(4)</span>
                    </a>
                </li>
                <li class="category-item">
                    <a href="/categories/azure" class="category-link">
                        <span class="category-name">Azure</span>
                        <span class="category-count">(3)</span>
                    </a>
                </li>
                <li class="category-item">
                    <a href="/categories/hyper-v" class="category-link">
                        <span class="category-name">Hyper-V</span>
                        <span class="category-count">(1)</span>
                    </a>
                </li>
                <li class="category-item">
                    <a href="/categories/monitor" class="category-link">
                        <span class="category-name">Monitor</span>
                        <span class="category-count">(1)</span>
                    </a>
                </li>
                <li class="category-item">
                    <a href="/categories/msgraph" class="category-link">
                        <span class="category-name">Msgraph</span>
                        <span class="category-count">(6)</span>
                    </a>
                </li>
                <li class="category-item">
                    <a href="/categories/security" class="category-link">
                        <span class="category-name">Security</span>
                        <span class="category-count">(1)</span>
                    </a>
                </li>
                <li class="category-item">
                    <a href="/categories/terraform" class="category-link">
                        <span class="category-name">Terraform</span>
                        <span class="category-count">(1)</span>
                    </a>
                </li>
                <li class="category-item">
                    <a href="/categories/tools" class="category-link">
                        <span class="category-name">Tools</span>
                        <span class="category-count">(1)</span>
                    </a>
                </li>
                <li class="category-item">
                    <a href="/categories/usage" class="category-link">
                        <span class="category-name">Usage</span>
                        <span class="category-count">(3)</span>
                    </a>
                </li>
            </ul>
        </div>

        
        <div class="social-links">
            <ul class="social-list">
                <li class="social-item">
                    <a href="https://github.com/lubenz007" target="_blank" rel="noopener noreferrer" class="social-link" title="GitHub">
                        <i class="fab fa-github"></i>
                    </a>
                </li>
                <li class="social-item">
                    <a href="https://linkedin.com/in/benedikt-gabriel-egilsson" target="_blank" rel="noopener noreferrer" class="social-link" title="LinkedIn">
                        <i class="fab fa-linkedin"></i>
                    </a>
                </li>
            </ul>
        </div>
    </div>
</aside>


<div class="sidebar-overlay" id="sidebar-overlay"></div>

<style>
 
.sidebar {
    position: fixed;
    top: 0;
    left: 0;
    width: 260px;
    height: 100vh;
    background-color: var(--sidebar-bg);
    border-right: 1px solid var(--border-color);
    z-index: 1000;
    transform: translateX(0);
    transition: transform 0.3s ease;
    overflow-y: auto;
    padding-top: 80px;  
}

.sidebar-content {
    padding: 1.5rem 1rem;
}

.site-info {
    margin-bottom: 2rem;
    text-align: center;
}

.profile-img {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    margin-bottom: 1rem;
}

.profile-title {
    font-size: 1.2rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
    color: var(--text-color);
}

.profile-subtitle {
    font-size: 0.9rem;
    color: var(--text-muted);
    margin: 0;
}

.sidebar-nav {
    margin-bottom: 2rem;
}

.nav-list {
    list-style: none;
    padding: 0;
    margin: 0;
}

.nav-item {
    margin-bottom: 0.5rem;
}

.nav-link {
    display: flex;
    align-items: center;
    padding: 0.75rem 1rem;
    color: var(--text-color);
    text-decoration: none;
    border-radius: 0.375rem;
    transition: background-color 0.2s ease;
}

.nav-link:hover {
    background-color: var(--primary-color);
    color: white;
}

.nav-icon {
    margin-right: 0.75rem;
    font-size: 1.1rem;
}

.categories-tree {
    margin-bottom: 2rem;
}

.tree-title {
    font-size: 1rem;
    font-weight: 600;
    margin-bottom: 1rem;
    color: var(--text-color);
    padding: 0 1rem;
}

.category-list {
    list-style: none;
    padding: 0;
    margin: 0;
}

.category-item {
    margin-bottom: 0.25rem;
}

.category-link {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.5rem 1rem;
    color: var(--text-color);
    text-decoration: none;
    border-radius: 0.25rem;
    transition: background-color 0.2s ease;
}

.category-link:hover {
    background-color: var(--primary-color);
    color: white;
}

.category-count {
    font-size: 0.85rem;
    color: var(--text-muted);
}

.category-link:hover .category-count {
    color: rgba(255, 255, 255, 0.8);
}

.social-links {
    margin-top: auto;
}

.social-title {
    font-size: 1rem;
    font-weight: 600;
    margin-bottom: 1rem;
    color: var(--text-color);
    padding: 0 1rem;
}

.social-list {
    list-style: none;
    padding: 0;
    margin: 0;
}

.social-item {
    margin-bottom: 0.25rem;
}

.social-link {
    display: block;
    padding: 0.5rem 1rem;
    color: var(--text-color);
    text-decoration: none;
    border-radius: 0.25rem;
    transition: background-color 0.2s ease;
}

.social-link:hover {
    background-color: var(--primary-color);
    color: white;
}

 
@media (max-width: 768px) {
    .sidebar {
        transform: translateX(-100%);
        width: 280px;
        box-shadow: 2px 0 10px rgba(0,0,0,0.1);
    }
    
    .sidebar.open {
        transform: translateX(0);
    }
    
    .sidebar-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.6);
        z-index: 999;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s ease, visibility 0.3s ease;
        backdrop-filter: blur(2px);
    }
    
    .sidebar-overlay.active {
        opacity: 1;
        visibility: visible;
    }
    
     
    .header {
        padding: 0.75rem 1rem;
        position: sticky;
        top: 0;
        z-index: 100;
        background-color: var(--header-bg);
        border-bottom: 1px solid var(--border-color);
    }
    
    .nav {
        justify-content: space-between;
        align-items: center;
    }
}

 
@media (min-width: 769px) {
    .main {
        margin-left: 260px;
    }
    
    .header {
        margin-left: 260px;
    }
}

 
.menu-toggle {
    display: none;
    flex-direction: column;
    background: none;
    border: none;
    cursor: pointer;
    padding: 0.5rem;
}

.menu-toggle span {
    width: 25px;
    height: 3px;
    background-color: var(--text-color);
    margin: 3px 0;
    transition: 0.3s;
}

@media (max-width: 768px) {
    .menu-toggle {
        display: flex;
    }
}
</style>

<script>

document.addEventListener('DOMContentLoaded', function() {
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('sidebar-overlay');
    const toggle = document.getElementById('menu-toggle');
    
    if (toggle && sidebar && overlay) {
        toggle.addEventListener('click', function() {
            sidebar.classList.toggle('open');
            overlay.classList.toggle('active');
        });
        
        overlay.addEventListener('click', function() {
            sidebar.classList.remove('open');
            overlay.classList.remove('active');
        });
    }
});
</script>
  
  
  <div class="sidebar-overlay"></div>
  
  
  <div class="main-wrapper">
    
    <div id="topbar">
      <div class="container-fluid">
        <button type="button" id="sidebar-toggle" class="btn btn-link d-lg-none">
          <i class="fas fa-bars fa-fw"></i>
        </button>
        <div id="breadcrumb">
          <span class="breadcrumb-item active">Home</span>
        </div>
        
        <div class="topbar-right">
          <nav class="top-nav d-none d-lg-block">
            <ul class="top-nav-list">
              <li class="top-nav-item">
                <a href="/search/" class="top-nav-link">
                  <i class="fas fa-search"></i>
                </a>
              </li>
              <li class="top-nav-item">
                <a href="/feed.xml" class="top-nav-link" title="RSS Feed">
                  <i class="fas fa-rss"></i>
                </a>
              </li>
            </ul>
          </nav>
          <button type="button" class="btn btn-link theme-toggle" id="theme-toggle">
            <i class="fas fa-adjust fa-fw"></i>
          </button>
        </div>
      </div>
    </div>
    
    
    <div class="content-wrapper">
      <main class="main">
        

<div class="main-content">
    <div class="page-content"><h1>Welcome to BensiEgils</h1><p>Documenting my journey with Azure, PowerShell, automation, and security.</p>
<h2>Latest Posts<span class="hx:absolute hx:-mt-20" id="latest-posts"></span>
    <a href="#latest-posts" class="subheading-anchor" aria-label="Permalink for this section"></a></h2><p>Browse my latest blog posts about Azure, PowerShell, automation, and security topics.</p>
<p><a href="/posts/">Explore All Posts â†’</a></p>
<h2>Categories<span class="hx:absolute hx:-mt-20" id="categories"></span>
    <a href="#categories" class="subheading-anchor" aria-label="Permalink for this section"></a></h2><ul>
<li><a href="/categories/azure/">Azure</a> - Cloud computing and Azure services</li>
<li><a href="/categories/powershell/">PowerShell</a> - Automation and scripting</li>
<li><a href="/categories/security/">Security</a> - Security best practices and tools</li>
<li><a href="/categories/automation/">Automation</a> - Process automation</li>
<li><a href="/categories/tools/">Tools</a> - Useful tools and utilities</li>
</ul>
<h2>About<span class="hx:absolute hx:-mt-20" id="about"></span>
    <a href="#about" class="subheading-anchor" aria-label="Permalink for this section"></a></h2><p>I&rsquo;m an IT professional with over 25 years of experience in virtualization, system administration, and cloud technologies.</p>
<p><a href="/about/">Learn more about me â†’</a></p>

    </div>
        <div class="post-content"><h1>Welcome to BensiEgils</h1><p>Documenting my journey with Azure, PowerShell, automation, and security.</p>
<h2>Latest Posts<span class="hx:absolute hx:-mt-20" id="latest-posts"></span>
    <a href="#latest-posts" class="subheading-anchor" aria-label="Permalink for this section"></a></h2><p>Browse my latest blog posts about Azure, PowerShell, automation, and security topics.</p>
<p><a href="/posts/">Explore All Posts â†’</a></p>
<h2>Categories<span class="hx:absolute hx:-mt-20" id="categories"></span>
    <a href="#categories" class="subheading-anchor" aria-label="Permalink for this section"></a></h2><ul>
<li><a href="/categories/azure/">Azure</a> - Cloud computing and Azure services</li>
<li><a href="/categories/powershell/">PowerShell</a> - Automation and scripting</li>
<li><a href="/categories/security/">Security</a> - Security best practices and tools</li>
<li><a href="/categories/automation/">Automation</a> - Process automation</li>
<li><a href="/categories/tools/">Tools</a> - Useful tools and utilities</li>
</ul>
<h2>About<span class="hx:absolute hx:-mt-20" id="about"></span>
    <a href="#about" class="subheading-anchor" aria-label="Permalink for this section"></a></h2><p>I&rsquo;m an IT professional with over 25 years of experience in virtualization, system administration, and cloud technologies.</p>
<p><a href="/about/">Learn more about me â†’</a></p>
</div>

    <article class="post-entry">
        
        <header class="entry-header">
            <h2 class="entry-title">
                <a href="http://localhost:1313/posts/getting-old-guest-accounts-in-azure-ad/">Getting old guest accounts in Azure AD</a>
            </h2>
        </header>
        <div class="entry-meta">
            <time datetime="2023-04-26T23:00:49Z">
                April 26, 2023
            </time>
            <span class="categories">
                <a href="/categories/msgraph">MsGraph</a>
            </span>
        </div>
        <div class="entry-content">
            <p>This is a rewrite from here office365itpros.com I have added some more properties to the report. And use msgraph instead of mggraph.
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 # Needs permission User.Read.All $ClientID = &#39;&#39; $ClientSecret = &#39;&#39; $tenant_Id = &#39;&#39; # Connect to Graph # $Body = @{ Grant_Type = &#34;client_credentials&#34; resource = &#34;https://graph.microsoft.com&#34; client_id = $clientId client_secret = $clientSecret } $ConnectGraph = Invoke-RestMethod -Uri &#34;https://login.microsoft.com/$tenant_Id/oauth2/token?api-version=1.0&#34; -Method POST -Body $Body # Variable Collections # $Headers = @{ &#39;Content-Type&#39; = &#34;application/json&#34; &#39;Authorization&#39; = &#34;Bearer $($ConnectGraph.access_token)&#34; } $token = $ConnectGraph.access_token # Force TLS 1.2. [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12 function Get-GraphData { param ( [parameter(Mandatory)] [string]$AccessToken, [parameter(Mandatory)] [string]$Uri ) $Headers = @{ &#39;Authorization&#39; = &#34;Bearer $AccessToken&#34; } do { $Results = Invoke-RestMethod -Uri $Uri -Headers $Headers -ErrorAction Stop $QueryResults &#43;= $Results.value $Uri = $Results.&#39;@odata.nextLink&#39; } while ($Uri) return $QueryResults } #This request get users list with signInActivity. $uri = &#34;https://graph.microsoft.com/beta/users&#34; $Result = @() [array]$Response = Get-GraphData -AccessToken $Token -Uri $uri if ($Response) { ForEach ($Respons in $Response) { $Result &#43;= New-Object PSObject -property $([ordered]@{ DisplayName = $Respons.displayName UserPrincipalName = $Respons.userPrincipalName UsageLocation = $Respons.usageLocation Contry = $Respons.country LastSignInDateTime = if($Respons.signInActivity.lastSignInDateTime) { [DateTime]$Respons.signInActivity.lastSignInDateTime } Else {$null} IsLicensed = if ($Respons.assignedLicenses.Count -ne 0) { $true } else { $false } IsGuestUser = if ($Respons.userType -eq &#39;Guest&#39;) { $true } else { $false } RefreshTokensValidFromDateTime = $Respons.RefreshTokensValidFromDateTime onPremisesDistinguishedName = $Respons.onPremisesDistinguishedName }) } } else { Write-Host &#34;No User data found&#34; } $GuestUsers = $Result | Where-Object{$_.IsGuestUser -eq &#34;TRUE&#34;} $GuestAccountAge = 365 # Value used for guest age comparison. If you want this to be a different value (like 30 days), change this here. #$GuestUsers = $users.value -All $true -Filter &#34;UserType eq &#39;Guest&#39;&#34; | Sort DisplayName $Today = (Get-Date); $StaleGuests = 0 $Report = [System.Collections.Generic.List[Object]]::new() # Check each account and find those over 365 days old ForEach ($Guest in $GuestUsers) { $AADAccountAge = ($Guest.RefreshTokensValidFromDateTime | New-TimeSpan).Days If ($AADAccountAge -gt $GuestAccountAge) { $StaleGuests&#43;&#43; #Write-Host &#34;Processing&#34; $Guest.DisplayName $i = 0; $GroupNames = $Null # Find what Microsoft 365 Groups the guest belongs to... if any $ReportLine = [PSCustomObject]@{ UPN = $Guest.UserPrincipalName Name = $Guest.DisplayName Age = $AADAccountAge Created = $Guest.RefreshTokensValidFromDateTime } $Report.Add($ReportLine) } } # Output the report $Report | Sort Age -Descending | Format-Table -AutoSize Write-Host &#34;Found&#34; $StaleGuests &#34;stale guest accounts.&#34; #reference: https://office365itpros.com/2019/10/15/report-old-guest-accounts/ </p>
        </div>
        
        <footer class="entry-footer">
        </footer>
        
        <a class="entry-link" aria-label="post link to Getting old guest accounts in Azure AD" href="http://localhost:1313/posts/getting-old-guest-accounts-in-azure-ad/"></a>
    </article>

    <article class="post-entry">
        
        <header class="entry-header">
            <h2 class="entry-title">
                <a href="http://localhost:1313/posts/getting-started-with-terraform-and-azure/">Getting started with Terraform and Azure</a>
            </h2>
        </header>
        <div class="entry-meta">
            <time datetime="2023-04-22T18:46:49Z">
                April 22, 2023
            </time>
            <span class="categories">
                <a href="/categories/terraform">Terraform</a>
            </span>
        </div>
        <div class="entry-content">
            <p>I like to watch videos on how to do things, but i donâ€™t like to start from scratch. I like to have a template from which i can start and test things out. So start to look out for exporting Azure config to templates. Terraformer is a tool that can export existing cloud infrastructure to Terraform code. But I like aztfexport better because it is more Azure-specific.
Install aztfexport is easy from package manager1 c:\winget install aztfexport And we need also Azure Cli1 c:\winget install azure-cli Login to AzureThis was the part I struggled with: where is the config file? It was too simple: login to Azure with Azure Cli and then select the subscription I wanted to export from. Terraform, Terraformer, and aztfexport will use the same subscription as Azure Cli.
...</p>
        </div>
        
        <footer class="entry-footer">
        </footer>
        
        <a class="entry-link" aria-label="post link to Getting started with Terraform and Azure" href="http://localhost:1313/posts/getting-started-with-terraform-and-azure/"></a>
    </article>

    <article class="post-entry">
        
        <header class="entry-header">
            <h2 class="entry-title">
                <a href="http://localhost:1313/posts/apps-expiration-azure-ad/">Apps Expiration Azure AD</a>
            </h2>
        </header>
        <div class="entry-meta">
            <time datetime="2023-04-07T10:34:00Z">
                April 7, 2023
            </time>
            <span class="categories">
                <a href="/categories/msgraph">MSGraph</a>
            </span>
        </div>
        <div class="entry-content">
            <p>This script will check all registered apps in Azure AD and will return the following information: expiring apps, expired apps, and apps with no expiration date.1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 # needs permission Application.Read.All,Directory.Read.All $ClientID = &#39;&#39; $ClientSecret = &#39;&#39; $tenant_Id = &#39;&#39; $TenantName = $Body = @{ Grant_Type = &#34;client_credentials&#34; resource = &#34;https://graph.microsoft.com&#34; client_id = $clientId client_secret = $clientSecret } $ConnectGraph = Invoke-RestMethod -Uri &#34;https://login.microsoft.com/$tenant_Id/oauth2/token?api-version=1.0&#34; -Method POST -Body $Body # Variable Collections # $path = &#34;C:\temp\&#34; $today = Get-Date $Headers = @{ &#39;Content-Type&#39; = &#34;application/json&#34; &#39;Authorization&#39; = &#34;Bearer $($ConnectGraph.access_token)&#34; } $token = $ConnectGraph.access_token # Force TLS 1.2. [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12 function Get-GraphData { param ( [parameter(Mandatory)] [string]$AccessToken, [parameter(Mandatory)] [string]$Uri ) $Headers = @{ &#39;Authorization&#39; = &#34;Bearer $AccessToken&#34; } do { $Results = Invoke-RestMethod -Uri $Uri -Headers $Headers -ErrorAction Stop $QueryResults &#43;= $Results.value $Uri = $Results.&#39;@odata.nextLink&#39; } while ($Uri) return $QueryResults } #This request get application info $uri = &#34;https://graph.microsoft.com/beta/applications/&#34; [array]$apps = Get-GraphData -AccessToken $Token -Uri $uri $credentials = @() if ($apps) { foreach ($app in $apps) { $ApiUrl = &#34;https://graph.microsoft.com/beta/applications/&#34;&#43;$app.id&#43;&#34;/owners&#34; $owner = Invoke-WebRequest -Method GET -Uri $ApiUrl -ContentType &#34;application/json&#34; -Headers $headers | ConvertFrom-Json $app.KeyCredentials | foreach-object { #write-host $_.KeyId $_.DisplayName $credentials &#43;= [PSCustomObject] @{ CredentialType = &#34;KeyCredentials&#34;; DisplayName = $app.DisplayName; AppId = $app.AppId; ExpiryDate = $_.EndDateTime; StartDate = $_.StartDateTime; #KeyID = $_.KeyId; Type = $_.Type; Usage = $_.Usage; Owners = $owner.value.userPrincipalName; Expired = (([DateTime]$_.EndDateTime) -lt $today) ? &#34;Yes&#34; : &#34;No&#34;; } } $app.PasswordCredentials | foreach-object { #write-host $_.KeyId $_.DisplayName $credentials &#43;= [PSCustomObject] @{ CredentialType = &#34;PasswordCredentials&#34;; DisplayName = $app.DisplayName; AppId = $app.AppId; ExpiryDate = $_.EndDateTime; StartDate = $_.StartDateTime; #KeyID = $_.KeyId; Type = &#39;NA&#39;; Usage = &#39;NA&#39;; Owners = $owner.value.userPrincipalName; Expired = (([DateTime]$_.EndDateTime) -lt $today) ? &#34;Yes&#34; : &#34;No&#34;; } } } } $credentials | Export-Csv -Path $path\credentials.csv -NoTypeInformation #$credentials | Format-Table | Out-String|ForEach-Object {Write-Host $_} reference https://pnp.github.io/script-samples/aad-apps-expired-keys/README.html?tabs=graphps {: .prompt-info }
...</p>
        </div>
        
        <footer class="entry-footer">
        </footer>
        
        <a class="entry-link" aria-label="post link to Apps Expiration Azure AD" href="http://localhost:1313/posts/apps-expiration-azure-ad/"></a>
    </article>

    <article class="post-entry">
        
        <header class="entry-header">
            <h2 class="entry-title">
                <a href="http://localhost:1313/posts/powershell-speedtest/">Powershell Speedtest</a>
            </h2>
        </header>
        <div class="entry-meta">
            <time datetime="2023-04-06T20:15:00Z">
                April 6, 2023
            </time>
            <span class="categories">
                <a href="/categories/automation">Automation</a>
            </span>
        </div>
        <div class="entry-content">
            <p>Was having problems with my internet connection and wanted to monitor it. So I rewrote this script to use powershell and store the results in a table storage.The script is using the speedtest cli from https://www.speedtest.net/apps/cli {: .prompt-info }
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 #$StorageAccountName = &#34;StorageAcount&#34; #$Key = &#34;Storagekey&#34; #$StorageContext = New-AzStorageContext -StorageAccountName $StorageAccountName -StorageAccountKey $Key #$Table = (Get-AzStorageTable -Context $StorageContext | Where-Object {$_.name -eq &#34;Speedtest&#34;}).CloudTable $applocation = &#34;C:\apps\speedtest&#34; $path = &#34;C:\temp\&#34; $SpeedTestResults=@() $SpeedtestObj=@() $i = 0 while ($i -eq 0) { $PartitionKey = &#34;1&#34; $SpeedTestResults = &amp; &#34;$($applocation)\speedtest.exe&#34; --progress=no --format=json $SpeedtestResults = $SpeedTestResults | ConvertFrom-Json $SpeedtestObj &#43;= [PSCustomObject] @{ Time = Get-Date -Format &#34;dd/MM/yyyy HH:mm K&#34; downloadspeed = [math]::Round($SpeedtestResults.download.bandwidth / 1000000 * 8, 2) uploadspeed = [math]::Round($SpeedtestResults.upload.bandwidth / 1000000 * 8, 2) packetloss = ($($SpeedtestResults.packetLoss).ToString(&#34;P&#34;)) isp = $SpeedtestResults.isp ExternalIP = $SpeedtestResults.interface.externalIp InternalIP = $SpeedtestResults.interface.internalIp UsedServer = $SpeedtestResults.server.host location = $SpeedTestResults.server.location Jitter = [math]::Round($SpeedtestResults.ping.jitter) Latency = [math]::Round($SpeedtestResults.ping.latency) } # ---- Move to table storage ---- # Add-AzTableRow -table $Table -PartitionKey $PartitionKey -RowKey (Get-Date).Ticks -property $SpeedtestObj Start-Sleep -Seconds 15 } #$SpeedtestObj | Format-Table | Out-String|ForEach-Object {Write-Host $_} $SpeedtestObj | Export-Csv -Path $path\speedtest.csv -NoTypeInformation </p>
        </div>
        
        <footer class="entry-footer">
        </footer>
        
        <a class="entry-link" aria-label="post link to Powershell Speedtest" href="http://localhost:1313/posts/powershell-speedtest/"></a>
    </article>

    <article class="post-entry">
        
        <header class="entry-header">
            <h2 class="entry-title">
                <a href="http://localhost:1313/posts/esp32-hot-tub-controller/">Esp32 Hot tub controller</a>
            </h2>
        </header>
        <div class="entry-meta">
            <time datetime="2023-04-04T22:15:00Z">
                April 4, 2023
            </time>
            <span class="categories">
                <a href="/categories/automation">Automation</a>
            </span>
        </div>
        <div class="entry-content">
            <p>This is my hot tub controler with outdoor shower controler. It is based on a ESP32 and a 4 channel relay module. It has a DS18B20 temperature sensor for the hot tub and a DS18B20 for the water in the hot tub. It also has a DS18B20 for the outdoor shower and a DS18B20 for the water in system.1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 esphome: name: pottastyring platform: ESP32 board: nodemcu-32s wifi: ssid: &#34;&#34; password: &#34;&#34; domain: .lan manual_ip: static_ip: 192.168.x.x gateway: 192.168.x.x subnet: 255.255.255.0 dns1: 192.168.x.x # Enable fallback hotspot (captive portal) in case wifi connection fails ap: ssid: &#34;hottub&#34; password: &#34;&#34; captive_portal: web_server: port: 80 # Enable logging logger: # Enable Home Assistant API api: ota: time: - platform: sntp id: timer servers: - 0.pool.ntp.org - 1.pool.ntp.org - 2.pool.ntp.org dallas: - pin: GPIO13 sensor: - platform: dallas address: 0x67011464EA7EFF28 name: &#34;Pottur hiti&#34; id: pottur_hiti - platform: dallas address: 0x8B0314649975FF28 name: &#34;Vatn i pott&#34; id: vatn_i_hiti - platform: dallas address: 0x110000045976f328 name: &#34;Hiti Skapur&#34; id: Hiti_skapur - platform: dallas address: 0xe10314645814ff28 name: &#34;Hiti Uti&#34; id: hiti_uti binary_sensor: - platform: gpio filters: - delayed_on: 100ms id: fylla pin: number: GPIO17 mode: INPUT_PULLUP inverted: True name: &#34;Pottur fylla takki&#34; on_press: if: condition: lambda: &#39;return id(pottur_hiti).state &lt; 20;&#39; then: - logger.log: &#34;The sensor value is below 20!&#34; - switch.turn_on: relay_1 - delay: 1min - switch.turn_on: relay_4 - delay: 30min - switch.turn_off: relay_1 - delay: 3min - climate.control: id: pottur_climate mode: &#34;HEAT&#34; else: - logger.log: &#34;The sensor value is above 20!&#34; - platform: gpio filters: - delayed_on: 500ms id: sturta pin: number: GPIO21 mode: INPUT_PULLUP inverted: True name: &#34;Sturta takki&#34; on_press: if: condition: lambda: &#39;return id(pottur_hiti).state &gt; 38;&#39; then: - logger.log: &#34;The sensor value is above 38!&#34; - climate.control: id: pottur_climate mode: &#34;OFF&#34; - delay: 10sec - switch.turn_on: relay_3 - delay: 4min - switch.turn_off: relay_3 else: - logger.log: &#34;The sensor value is below 20!&#34; - switch.turn_on: relay_3 - delay: 4min - switch.turn_off: relay_3 - platform: gpio filters: - delayed_on: 500ms id: nidurfall pin: number: GPIO33 mode: INPUT_PULLUP inverted: True name: &#34;taema takki&#34; on_press: then: - switch.turn_off: relay_4 - climate.control: id: pottur_climate mode: &#34;off&#34; switch: - platform: gpio restore_mode: ALWAYS_OFF name: &#34;Pottur fylla relay&#34; pin: GPIO25 id: relay_1 - platform: gpio restore_mode: ALWAYS_OFF name: &#34;Pottur hita relay&#34; pin: GPIO26 id: relay_2 - platform: gpio restore_mode: ALWAYS_OFF name: &#34;Sturta relay&#34; pin: GPIO27 id: relay_3 - platform: gpio restore_mode: ALWAYS_ON name: &#34;Loka nidurfalli&#34; pin: GPIO18 id: relay_4 climate: - platform: bang_bang id: pottur_climate visual: min_temperature: 38 max_temperature: 42 temperature_step: 1.0 name: &#34;Pottur vatn&#34; sensor: pottur_hiti default_target_temperature_low: 38 Â°C default_target_temperature_high: 40 Â°C heat_action: if: condition: lambda: &#39;return id(pottur_hiti).state &gt; 32;&#39; then: - logger.log: &#34;The sensor is above 32! then full&#34; - switch.turn_on: relay_1 - switch.turn_on: relay_2 else: - logger.log: &#34;The sensor value is below 32!&#34; - switch.turn_on: relay_1 - delay: 1min - switch.turn_on: relay_4 - delay: 30min - switch.turn_on: relay_2 idle_action: - switch.turn_off: relay_2 - switch.turn_off: relay_1 mqtt: broker: 192.168.x.x username: xxx password: xxx </p>
        </div>
        
        <footer class="entry-footer">
        </footer>
        
        <a class="entry-link" aria-label="post link to Esp32 Hot tub controller" href="http://localhost:1313/posts/esp32-hot-tub-controller/"></a>
    </article>

    <article class="post-entry">
        
        <header class="entry-header">
            <h2 class="entry-title">
                <a href="http://localhost:1313/posts/upgrade-hyper-v-hosts-with-azure-arc/">Upgrade Hyper-V Hosts with Azure Arc</a>
            </h2>
        </header>
        <div class="entry-meta">
            <time datetime="2023-04-04T22:15:00Z">
                April 4, 2023
            </time>
            <span class="categories">
                <a href="/categories/automation">Automation</a>
            </span>
        </div>
        <div class="entry-content">
            <p>Azure Arc is a powerful tool for managing and updating hybrid infrastructure, including standalone Hyper-V hosts. Demo how to use Azure Arc to update a standalone Hyper-V host, using a scheduled update task in Automation Account and pre and post scripts that shut down and start up VMs.Pre-requisites
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # Stop all running VMs on the Hyper-V host and wait for them to shut down # save the names of the running VMs to a file $filePath = &#34;C:\temp\runningvm.txt&#34; (Get-vm | Where-Object { $_.State -eq &#34;Running&#34; }).name | Out-File $filePath $runningvm = Get-Content $filePath foreach ($Name in $runningvm) { Stop-VM $Name do { $VM1 = get-vm -Name $Name Write-Progress -Activity &#34;Waiting for the VM to shutdown&#34; } until ($Null -eq $VM1.Heartbeat) } # send a webhook to Teams to notify that the VMs have been shut down $webhookUri = &#34;&#34; $body = @{ &#34;@context&#34; = &#34;http://schema.org/extensions&#34; &#34;@type&#34; = &#34;MessageCard&#34; &#34;themeColor&#34; = &#34;d70000&#34; &#34;title&#34; = &#34;Send Webhook to Teams&#34; &#34;text&#34; = &#34;This is a message sent from Powershell&#34; } Invoke-RestMethod -Uri $webhookUri -Method Post -Body (ConvertTo-Json -InputObject $body) Post-requisites
...</p>
        </div>
        
        <footer class="entry-footer">
        </footer>
        
        <a class="entry-link" aria-label="post link to Upgrade Hyper-V Hosts with Azure Arc" href="http://localhost:1313/posts/upgrade-hyper-v-hosts-with-azure-arc/"></a>
    </article>

    <article class="post-entry">
        
        <header class="entry-header">
            <h2 class="entry-title">
                <a href="http://localhost:1313/posts/getting-licenses-assigned-to-user-accounts/">Getting licenses assigned to user accounts</a>
            </h2>
        </header>
        <div class="entry-meta">
            <time datetime="2023-04-01T00:27:00Z">
                April 1, 2023
            </time>
            <span class="categories">
                <a href="/categories/msgraph">MSGraph</a>
            </span>
        </div>
        <div class="entry-content">
            <p>Create a report of licenses assigned to Azure AD user accounts using the Microsoft Graph APIThis is a rewrite from here practical365.comMy misson was to rewrite the script to use the Microsoft Graph API instead of the MgGraph PowerShell module. {: .prompt-info }
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 $ClientID = &#39;&#39; $ClientSecret = &#39;&#39; $tenant_Id = &#39;&#39; # Connect to Graph # $Body = @{ Grant_Type = &#34;client_credentials&#34; resource = &#34;https://graph.microsoft.com&#34; client_id = $clientId client_secret = $clientSecret } $ConnectGraph = Invoke-RestMethod -Uri &#34;https://login.microsoft.com/$tenant_Id/oauth2/token?api-version=1.0&#34; -Method POST -Body $Body # Variable Collections # $CSVOutputFile = &#34;c:\temp\Microsoft365LicensesReport.CSV&#34; $today = Get-Date $Headers = @{ &#39;Content-Type&#39; = &#34;application/json&#34; &#39;Authorization&#39; = &#34;Bearer $($ConnectGraph.access_token)&#34; } $token = $ConnectGraph.access_token # Force TLS 1.2. [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12 function Get-GraphData { param ( [parameter(Mandatory)] [string]$AccessToken, [parameter(Mandatory)] [string]$Uri ) $Headers = @{ &#39;Authorization&#39; = &#34;Bearer $AccessToken&#34; } do { $Results = Invoke-RestMethod -Uri $Uri -Headers $Headers -ErrorAction Stop $QueryResults &#43;= $Results.value $Uri = $Results.&#39;@odata.nextLink&#39; } while ($Uri) return $QueryResults } #This request get SecureScore [array]$Skus = Get-GraphData -AccessToken $Token -Uri &#34;https://graph.microsoft.com/beta/subscribedSkus&#34; #[Array]$Skus = Get-MgSubscribedSku # Generate CSV of all product SKUs used in tenant [array]$Sku = $Skus | Select-Object SkuId, SkuPartNumber # Generate list of all service plans used in SKUs in tenant $SPData = [System.Collections.Generic.List[Object]]::new() ForEach ($Sk in $Skus) { ForEach ($SP in $Sk.ServicePlans) { $SPLine = [PSCustomObject][Ordered]@{ ServicePlanId = $SP.ServicePlanId ServicePlanName = $SP.ServicePlanName ServicePlanDisplayName = $SP.ServicePlanName } $SPData.Add($SPLine) } } $SkuHashTable = @{} ForEach ($Line in $Sku) { $SkuHashTable.Add([string]$Line.SkuId, [string]$Line.skuPartNumber) } $ServicePlanHashTable = @{} ForEach ($Line2 in $SPData) { $ServicePlanHashTable.Add([string]$Line2.ServicePlanId, [string]$Line2.ServicePlanDisplayName) } [Array]$Users = Get-GraphData -AccessToken $Token -Uri &#34;https://graph.microsoft.com/beta/users&#34; $Report = [System.Collections.Generic.List[Object]]::new() ForEach ($User in $users) { If ([string]::IsNullOrWhiteSpace($User.AssignedLicenses) -eq $true) { # Only process account if it has some licenses Write-Host &#34;Processing&#34; $User.DisplayName [array]$LicenseInfo = $Null; [array]$DisabledPlans = $Null ForEach ($License in $User.AssignedLicenses) { If ($SkuHashTable.ContainsKey($License.SkuId) -eq $True) { # We found a match in the SKU hash table $LicenseInfo &#43;= $SkuHashTable.Item($License.SkuId) } Else { # Nothing doing, so output the SkuID $LicenseInfo &#43;= $License } # Report any disabled service plans in licenses If ([string]::IsNullOrWhiteSpace($License.DisabledPlans) -eq $False ) { # Check if disabled service plans in a license ForEach ($DisabledPlan in $License.DisabledPlans) { # Try and find what service plan is disabled If ($ServicePlanHashTable.ContainsKey($DisabledPlan) -eq $True) { # We found a match in the Service Plans hash table $DisabledPlans &#43;= $ServicePlanHashTable.Item($DisabledPlan) } Else { # Nothing doing, so output the Service Plan ID $DisabledPlans &#43;= $DisabledPlan } } # End ForEach disabled plans } # End if check for disabled plans } # End Foreach Licenses # Report information [string]$DisabledPlans = $DisabledPlans -join &#34;, &#34; [string]$LicenseInfo = $LicenseInfo -join (&#34;, &#34;) $ReportLine = [PSCustomObject][Ordered]@{ User = $User.DisplayName UPN = $User.UserPrincipalName Country = $User.Country Department = $User.Department Title = $User.JobTitle Licenses = $LicenseInfo &#34;Disabled Plans&#34; = $DisabledPlans } Write-Host $ReportLine $Report.Add($ReportLine) } #end If account is licensed Else { $UnlicensedAccounts&#43;&#43; } } # End ForEach Users $Report | Export-CSV -NoTypeInformation $CSVOutputFile </p>
        </div>
        
        <footer class="entry-footer">
        </footer>
        
        <a class="entry-link" aria-label="post link to Getting licenses assigned to user accounts" href="http://localhost:1313/posts/getting-licenses-assigned-to-user-accounts/"></a>
    </article>

    <article class="post-entry">
        
        <header class="entry-header">
            <h2 class="entry-title">
                <a href="http://localhost:1313/posts/ms-graph-api-get-secure-score-for-tenant/">MS Graph API - Get Secure Score for tenant</a>
            </h2>
        </header>
        <div class="entry-meta">
            <time datetime="2023-03-25T22:49:00Z">
                March 25, 2023
            </time>
            <span class="categories">
                <a href="/categories/msgraph">MSGraph</a>
            </span>
        </div>
        <div class="entry-content">
            <p>Secure Score for O365 TenantGetting the secure score for a tenant is a bit more complicated than getting the last logon time of a user.You only need to call the following endpoint: https://graph.microsoft.com/beta/security/secureScores and divide the result by 100 to get the percentage.
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 # Needs permission SecurityEvents.Read.All $ClientID = &#39;&#39; $ClientSecret = &#39;&#39; $tenant_Id = &#39;&#39; # Connect to Graph # $Body = @{ Grant_Type = &#34;client_credentials&#34; resource = &#34;https://graph.microsoft.com&#34; client_id = $clientId client_secret = $clientSecret } $ConnectGraph = Invoke-RestMethod -Uri &#34;https://login.microsoft.com/$tenant_Id/oauth2/token?api-version=1.0&#34; -Method POST -Body $Body # Variable Collections # $path = &#34;C:\temp\&#34; $Headers = @{ &#39;Content-Type&#39; = &#34;application/json&#34; &#39;Authorization&#39; = &#34;Bearer $($ConnectGraph.access_token)&#34; } $token = $ConnectGraph.access_token # Force TLS 1.2. [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12 function Get-GraphData { param ( [parameter(Mandatory)] [string]$AccessToken, [parameter(Mandatory)] [string]$Uri ) $Headers = @{ &#39;Authorization&#39; = &#34;Bearer $AccessToken&#34; } do { $Results = Invoke-RestMethod -Uri $Uri -Headers $Headers -ErrorAction Stop $QueryResults &#43;= $Results.value $Uri = $Results.&#39;@odata.nextLink&#39; } while ($Uri) return $QueryResults } #This request get SecureScore $uri = &#34;https://graph.microsoft.com/beta/security/secureScores&#34; $Result = @() [array]$Response = Get-GraphData -AccessToken $Token -Uri $uri if ($Response) { ForEach ($Respons in $Response) { $SecureScore = $Respons.currentScore / $Respons.maxScore * 100 $Result &#43;= New-Object PSObject -property $([ordered]@{ CreatedDateTime = $Respons.createdDateTime CurrentScore = $Respons.currentScore MaxScore = $Respons.maxScore LicensedUserCount = $Respons.licensedUserCount ActiveUserCount = $Respons.activeUserCount SecureScore = [math]::Round($SecureScore, 2) }) } } else { Write-Host &#34;No SecureScore data found&#34; } # export to csv $Result | export-csv -path &#34;$path\SecureScore.csv&#34; -NoTypeInformation </p>
        </div>
        
        <footer class="entry-footer">
        </footer>
        
        <a class="entry-link" aria-label="post link to MS Graph API - Get Secure Score for tenant" href="http://localhost:1313/posts/ms-graph-api-get-secure-score-for-tenant/"></a>
    </article>

    <article class="post-entry">
        
        <header class="entry-header">
            <h2 class="entry-title">
                <a href="http://localhost:1313/posts/getting-started-with-msgraph-api/">Getting Started with MSGraph API</a>
            </h2>
        </header>
        <div class="entry-meta">
            <time datetime="2023-03-25T13:49:00Z">
                March 25, 2023
            </time>
            <span class="categories">
                <a href="/categories/msgraph">MSGraph</a>
            </span>
        </div>
        <div class="entry-content">
            <p>Authentication and AuthorizationMSGraph API is a powerful tool for authentication and authorization that allows developers to access Microsoft services and data. It provides a secure way to authenticate users, authorize applications, and manage user data. With MSGraph API, developers can easily integrate their applications with Microsoft services like Outlook, OneDrive, Office 365, Azure Active Directory, and more. In this article, weâ€™ll explore how to get started with MSGraph API concepts and use cases of the API.AuthenticationWe will use the Azure CLI to create a service principal and get the app id and secret. We will also use the Azure CLI to view all the API permissions available in Microsoft Graph.Get the Azure CLI from here {: .prompt-info }
...</p>
        </div>
        
        <footer class="entry-footer">
        </footer>
        
        <a class="entry-link" aria-label="post link to Getting Started with MSGraph API" href="http://localhost:1313/posts/getting-started-with-msgraph-api/"></a>
    </article>

    <article class="post-entry">
        
        <header class="entry-header">
            <h2 class="entry-title">
                <a href="http://localhost:1313/posts/ms-graph-api-get-user-info/">MS Graph API - Get User info</a>
            </h2>
        </header>
        <div class="entry-meta">
            <time datetime="2023-03-25T13:49:00Z">
                March 25, 2023
            </time>
            <span class="categories">
                <a href="/categories/msgraph">MSGraph</a>
            </span>
        </div>
        <div class="entry-content">
            <p>Microsoft Graph API can be used to get the last logon time of a user. To do this, you will need to make a GET request to the /users/{id}/lastLogonTimeStamp endpoint. This endpoint will return the last logon time of the user in the form of a timestamp. You can then use this timestamp to determine the exact date and time of the userâ€™s last logon.This query getâ€™s.
...</p>
        </div>
        
        <footer class="entry-footer">
        </footer>
        
        <a class="entry-link" aria-label="post link to MS Graph API - Get User info" href="http://localhost:1313/posts/ms-graph-api-get-user-info/"></a>
    </article>
    <footer class="page-footer">
        <nav class="pagination">
                <a class="prev" href="/">
                    Â«&nbsp;
                </a>
                    <a href="/">1</a>
                    <a class="current" aria-current="page">2</a>
        </nav>
    </footer>
</div>
      </main>
      
      
      <div class="right-sidebar-wrapper d-none d-xl-block">
        
<aside class="right-sidebar" id="right-sidebar">
    <div class="widget-area">
        
        
        <div class="widget recent-posts-widget">
            <h4 class="widget-title">Recent Posts</h4>
            <ul class="recent-posts-list">
                <li class="recent-post-item">
                    <a href="/posts/migrating-from-vmware-to-azure-using-azure-files/" class="recent-post-link">
                        <div class="recent-post-meta">
                            <time class="recent-post-date">Aug 18</time>
                        </div>
                        <h5 class="recent-post-title">Migrating from VMware to Azure using Azure Files</h5>
                    </a>
                </li>
                <li class="recent-post-item">
                    <a href="/posts/gspro-control-box/" class="recent-post-link">
                        <div class="recent-post-meta">
                            <time class="recent-post-date">Jun 23</time>
                        </div>
                        <h5 class="recent-post-title">GSPRO Control box</h5>
                    </a>
                </li>
                <li class="recent-post-item">
                    <a href="/posts/arc-diskspace-monitoring-teams/" class="recent-post-link">
                        <div class="recent-post-meta">
                            <time class="recent-post-date">Oct 15</time>
                        </div>
                        <h5 class="recent-post-title">Arc - Diskspace Monitoring - Teams)</h5>
                    </a>
                </li>
                <li class="recent-post-item">
                    <a href="/posts/azure-arc-azure-cli-ssh-rdp/" class="recent-post-link">
                        <div class="recent-post-meta">
                            <time class="recent-post-date">Oct 8</time>
                        </div>
                        <h5 class="recent-post-title">Azure Arc - (Azure Cli - ssh - rdp)</h5>
                    </a>
                </li>
                <li class="recent-post-item">
                    <a href="/posts/hyper-v-tool/" class="recent-post-link">
                        <div class="recent-post-meta">
                            <time class="recent-post-date">Sep 30</time>
                        </div>
                        <h5 class="recent-post-title">hyper-v-tool</h5>
                    </a>
                </li>
            </ul>
        </div>

        
        <div class="widget categories-widget">
            <h4 class="widget-title">Top Categories</h4>
            <ul class="categories-list">
                <li class="category-item">
                    <a href="/categories/msgraph" class="category-link">
                        <span class="category-name">Msgraph</span>
                        <span class="category-count">6</span>
                    </a>
                </li>
                <li class="category-item">
                    <a href="/categories/automation" class="category-link">
                        <span class="category-name">Automation</span>
                        <span class="category-count">4</span>
                    </a>
                </li>
                <li class="category-item">
                    <a href="/categories/azure" class="category-link">
                        <span class="category-name">Azure</span>
                        <span class="category-count">3</span>
                    </a>
                </li>
                <li class="category-item">
                    <a href="/categories/usage" class="category-link">
                        <span class="category-name">Usage</span>
                        <span class="category-count">3</span>
                    </a>
                </li>
                <li class="category-item">
                    <a href="/categories/hyper-v" class="category-link">
                        <span class="category-name">Hyper-V</span>
                        <span class="category-count">1</span>
                    </a>
                </li>
                <li class="category-item">
                    <a href="/categories/monitor" class="category-link">
                        <span class="category-name">Monitor</span>
                        <span class="category-count">1</span>
                    </a>
                </li>
            </ul>
        </div>

        
        <div class="widget tags-widget">
            <h4 class="widget-title">Popular Tags</h4>
            <div class="tag-cloud">
                <a href="/tags/azure" class="tag-cloud-item">
                    azure
                </a>
                <a href="/tags/msgraph" class="tag-cloud-item">
                    msgraph
                </a>
                <a href="/tags/automation" class="tag-cloud-item">
                    automation
                </a>
                <a href="/tags/usage" class="tag-cloud-item">
                    usage
                </a>
                <a href="/tags/esp32" class="tag-cloud-item">
                    esp32
                </a>
                <a href="/tags/hyperv" class="tag-cloud-item">
                    hyperv
                </a>
                <a href="/tags/monitor" class="tag-cloud-item">
                    monitor
                </a>
                <a href="/tags/powershell" class="tag-cloud-item">
                    powershell
                </a>
                <a href="/tags/security" class="tag-cloud-item">
                    security
                </a>
                <a href="/tags/terraform" class="tag-cloud-item">
                    terraform
                </a>
            </div>
        </div>

    </div>
</aside>
      </div>
    </div>
    
    
    <footer class="hextra-footer hx:bg-gray-100 hx:pb-[env(safe-area-inset-bottom)] hx:dark:bg-neutral-900 hx:print:bg-transparent"><div class="hextra-custom-footer hextra-max-footer-width hx:pl-[max(env(safe-area-inset-left),1.5rem)] hx:pr-[max(env(safe-area-inset-right),1.5rem)] hx:text-gray-600 hx:dark:text-gray-400"></div><div
      class="hextra-max-footer-width hx:mx-auto hx:flex hx:justify-center hx:py-12 hx:pl-[max(env(safe-area-inset-left),1.5rem)] hx:pr-[max(env(safe-area-inset-right),1.5rem)] hx:text-gray-600 hx:dark:text-gray-400 hx:md:justify-start"
    >
      <div class="hx:flex hx:w-full hx:flex-col hx:items-center hx:sm:items-start"><div class="hx:font-semibold"><a class="hx:flex hx:text-sm hx:items-center hx:gap-1 hx:text-current" target="_blank" rel="noopener noreferrer" title="Hextra GitHub Homepage" href="https://github.com/imfing/hextra">
    <span>Powered by Hextra<svg height=1em class="hx:inline-block hx:ltr:ml-1 hx:rtl:mr-1 hx:align-[-2.5px]" viewBox="0 0 180 180" xmlns="http://www.w3.org/2000/svg" fill="currentColor"><path fill-rule="evenodd" clip-rule="evenodd" d="m 105.50024,22.224647 c -9.59169,-5.537563 -21.40871,-5.537563 -31.000093,0 L 39.054693,42.689119 C 29.463353,48.226675 23.55484,58.460531 23.55484,69.535642 v 40.928918 c 0,11.07542 5.908513,21.3092 15.499853,26.84652 l 35.445453,20.46446 c 9.591313,5.53732 21.408404,5.53732 31.000094,0 l 35.44507,-20.46446 c 9.59131,-5.53732 15.49985,-15.7711 15.49985,-26.84652 V 69.535642 c 0,-11.075111 -5.90854,-21.308967 -15.49985,-26.846523 z M 34.112797,85.737639 c -1.384445,2.397827 -1.384445,5.352099 0,7.749927 l 24.781554,42.922974 c 1.38437,2.39783 3.942853,3.87496 6.711592,3.87496 h 49.563107 c 2.76905,0 5.3273,-1.47713 6.71144,-3.87496 l 24.78194,-42.922974 c 1.38414,-2.397828 1.38414,-5.3521 0,-7.749927 L 121.88049,42.814746 c -1.38414,-2.397828 -3.94239,-3.874964 -6.71144,-3.874964 H 65.605944 c -2.768739,0 -5.327223,1.477059 -6.711592,3.874964 z" style="stroke-width:0.774993" /></svg></span>
  </a></div><div class="hx:mt-6 hx:text-xs">Â© 2025 Hextra Project.</div></div>
    </div></footer>
  </div>

  
  <script>
    
    document.addEventListener('DOMContentLoaded', function() {
      const themeToggle = document.getElementById('theme-toggle');
      const sidebarToggle = document.getElementById('sidebar-toggle');
      const sidebar = document.getElementById('sidebar');
      const overlay = document.querySelector('.sidebar-overlay');
      
      
      if (themeToggle) {
        themeToggle.addEventListener('click', function() {
          const currentTheme = document.documentElement.getAttribute('data-theme');
          const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
          document.documentElement.setAttribute('data-theme', newTheme);
          localStorage.setItem('theme', newTheme);
        });
      }
      
      
      if (sidebarToggle) {
        sidebarToggle.addEventListener('click', function() {
          sidebar.classList.toggle('active');
          overlay.classList.toggle('active');
          document.body.classList.toggle('sidebar-open');
        });
      }
      
      
      if (overlay) {
        overlay.addEventListener('click', function() {
          sidebar.classList.remove('active');
          overlay.classList.remove('active');
          document.body.classList.remove('sidebar-open');
        });
      }
      
      
      const navToggles = document.querySelectorAll('.nav-toggle');
      navToggles.forEach(function(toggle) {
        toggle.addEventListener('click', function(e) {
          e.preventDefault();
          const parent = this.parentElement;
          const submenu = parent.querySelector('.nav-submenu');
          
          
          parent.classList.toggle('open');
          
          
          navToggles.forEach(function(otherToggle) {
            if (otherToggle !== toggle) {
              otherToggle.parentElement.classList.remove('open');
            }
          });
        });
      });
      
      
      const savedTheme = localStorage.getItem('theme') || 'auto';
      if (savedTheme === 'auto') {
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        document.documentElement.setAttribute('data-theme', prefersDark ? 'dark' : 'light');
      } else {
        document.documentElement.setAttribute('data-theme', savedTheme);
      }
    });
  </script>
</body>
</html>