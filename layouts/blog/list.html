{{ define "main" }}
  {{- $readMore := (T "readMore") | default "Read more â†’" -}}
  <div class="hx:mx-auto hx:flex hextra-max-page-width">
    {{ partial "sidebar.html" (dict "context" . "disableSidebar" true "displayPlaceholder" true) }}
    
    <!-- Custom TOC for Blog Posts List -->
    <nav class="hextra-toc hx:order-last hx:hidden hx:w-64 hx:shrink-0 hx:xl:block hx:print:hidden hx:px-4" aria-label="blog posts table of contents">
      <div class="hextra-scrollbar hx:sticky hx:top-16 hx:overflow-y-auto hx:pr-4 hx:pt-6 hx:text-sm [hyphens:auto] hx:max-h-[calc(100vh-var(--navbar-height)-env(safe-area-inset-bottom))] hx:ltr:-mr-4 hx:rtl:-ml-4">
        <p class="hx:mb-4 hx:font-semibold hx:tracking-tight">All Blog Posts</p>
        <ul class="hx:space-y-2">
          {{- $pages := partial "utils/sort-pages" (dict "page" . "by" site.Params.blog.list.sortBy "order" site.Params.blog.list.sortOrder) -}}
          {{- range first 20 $pages }}
          <li>
            <a href="{{ .Permalink }}" class="hx:block hx:text-gray-600 hx:dark:text-gray-400 hx:hover:text-blue-600 hx:dark:hover:text-blue-400 hx:py-1 hx:leading-relaxed hx:transition-colors">
              <div class="hx:font-medium hx:text-xs hx:truncate">{{ .Title }}</div>
              <div class="hx:text-xs hx:text-gray-400 hx:dark:text-gray-500 hx:mt-1">{{ .Date.Format "Jan 2, 2006" }}</div>
            </a>
          </li>
          {{ end }}
          {{- if gt (len $pages) 20 }}
          <li class="hx:pt-2 hx:text-xs hx:text-gray-400 hx:dark:text-gray-500">
            ... and {{ sub (len $pages) 20 }} more posts
          </li>
          {{ end }}
        </ul>
        
        <!-- Categories in TOC -->
        <div class="hx:mt-8 hx:border-t hx:pt-4 hx:border-gray-200 hx:dark:border-neutral-800">
          <p class="hx:mb-3 hx:font-semibold hx:tracking-tight hx:text-xs">Categories</p>
          <ul class="hx:space-y-1">
            {{ range $taxonomy := site.Taxonomies.categories }}
              {{ $category := $taxonomy.Page }}
              <li>
                <a href="{{ $category.Permalink }}" class="hx:text-xs hx:text-gray-600 hx:dark:text-gray-400 hx:hover:text-blue-600 hx:dark:hover:text-blue-400 hx:transition-colors">
                  {{ $category.Title }} ({{ len $taxonomy.Pages }})
                </a>
              </li>
            {{ end }}
          </ul>
        </div>
      </div>
    </nav>
    
    <article class="hx:w-full hx:break-words hx:flex hx:min-h-[calc(100vh-var(--navbar-height))] hx:min-w-0 hx:justify-center hx:pb-8 hx:pr-[calc(env(safe-area-inset-right)-1.5rem)]">
      <main class="hx:w-full hx:min-w-0 hx:max-w-6xl hx:px-6 hx:pt-4 hx:md:px-12">
        {{ partial "breadcrumb.html" (dict "page" . "enable" false) }}
        <br class="hx:mt-1.5 hx:text-sm" />
        {{ if .Title }}<h1 class="hx:text-center hx:mt-2 hx:text-4xl hx:font-bold hx:tracking-tight hx:text-slate-900 hx:dark:text-slate-100">{{ .Title }}</h1>{{ end }}
        
        <div class="content hx:mb-8">
          {{ .Content }}
        </div>

        {{- $pages := partial "utils/sort-pages" (dict "page" . "by" site.Params.blog.list.sortBy "order" site.Params.blog.list.sortOrder) -}}
        {{- $pagerSize := site.Params.blog.list.pagerSize | default 10 -}}
        {{- $paginator := .Paginate $pages $pagerSize -}}
        
        <!-- Blog Posts Grid with Same Style as Homepage -->
        <div class="hx:space-y-6">
          {{- range $paginator.Pages }}
          <div class="hx:p-6 hx:border hx:border-gray-200 hx:rounded-lg hx:shadow-sm hx:dark:border-gray-700 hx:dark:bg-gray-800/50">
            <h3 class="hx:text-xl hx:font-semibold hx:mb-3">
              <a href="{{ .Permalink }}" class="hx:text-blue-600 hx:dark:text-blue-400 hx:hover:underline hx:decoration-2">{{ .Title }}</a>
            </h3>
            <div class="hx:flex hx:items-center hx:gap-4 hx:text-sm hx:text-gray-600 hx:dark:text-gray-400 hx:mb-3">
              <time datetime="{{ .Date.Format "2006-01-02" }}">{{ .Date.Format "January 2, 2006" }}</time>
              {{ if site.Params.blog.list.displayTags }}
                <div class="hx:flex hx:gap-2">
                  {{ range .Params.categories }}
                    <span class="hx:bg-blue-100 hx:text-blue-800 hx:px-2 hx:py-1 hx:rounded hx:text-xs hx:dark:bg-blue-900 hx:dark:text-blue-300">{{ . }}</span>
                  {{ end }}
                </div>
              {{ end }}
            </div>
            {{ if .Params.image }}
            <div class="hx:mb-4">
              <img src="{{ .Params.image }}" alt="{{ .Title }}" class="hx:w-full hx:h-48 hx:object-cover hx:rounded-lg">
            </div>
            {{ end }}
            <p class="hx:text-gray-700 hx:dark:text-gray-300 hx:mb-4 hx:leading-relaxed">{{- partial "utils/page-description" . -}}</p>
            <a href="{{ .Permalink }}" class="hx:inline-flex hx:items-center hx:text-blue-600 hx:dark:text-blue-400 hx:hover:underline hx:font-medium">
              {{ $readMore }}
              <svg class="hx:w-4 hx:h-4 hx:ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
              </svg>
            </a>
          </div>
          {{ end }}
        </div>
        
        {{- if gt $paginator.TotalPages 1 -}}
          <div class="hx:mt-12">
            {{ partial "components/blog-pager.html" $paginator }}
          </div>
        {{- end -}}
      </main>
    </article>
  </div>
{{- end -}}